"use strict";(()=>{var e={};e.id=149,e.ids=[149],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5900:e=>{e.exports=require("pg")},4460:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>b,patchFetch:()=>f,requestAsyncStorage:()=>g,routeModule:()=>d,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var a={};s.r(a),s.d(a,{DELETE:()=>c,GET:()=>u,PATCH:()=>l});var r=s(9303),o=s(8716),i=s(670),n=s(7070),p=s(9487);async function u(e){try{let t;let{searchParams:s}=new URL(e.url),a=s.get("status"),r=s.get("page")?parseInt(s.get("page")):void 0,o=s.get("pageSize")?parseInt(s.get("pageSize")):void 0,i=s.get("search")||void 0,u=s.get("categoryIds")?.split(",").map(Number).filter(Boolean),l=s.get("countryIds")?.split(",").map(Number).filter(Boolean),c=s.get("cityIds")?.split(",").map(Number).filter(Boolean),d=s.get("feedNames")?.split(",").filter(Boolean);if(void 0!==r||void 0!==o||i||u||l||c||d){let e=await p.db.getMaterialsPaginated({page:r,pageSize:o,status:a||void 0,search:i,categoryIds:u,countryIds:l,cityIds:c,feedNames:d}),t=await p.db.getStats();return n.NextResponse.json({success:!0,data:e.materials,pagination:{page:e.page,pageSize:e.pageSize,total:e.total,totalPages:e.totalPages},stats:{total:parseInt(t.total||"0"),new:parseInt(t.new_count||"0"),processed:parseInt(t.processed_count||"0"),published:parseInt(t.published_count||"0"),archived:parseInt(t.archived_count||"0")}})}t=a&&"all"!==a?await p.db.getMaterialsByStatus(a):await p.db.getAllMaterials();let g=await p.db.getStats();return n.NextResponse.json({success:!0,data:t,stats:{total:parseInt(g.total||"0"),new:parseInt(g.new_count||"0"),processed:parseInt(g.processed_count||"0"),published:parseInt(g.published_count||"0"),archived:parseInt(g.archived_count||"0")}})}catch(e){return console.error("API Error:",e),n.NextResponse.json({success:!1,error:"Failed to fetch materials"},{status:500})}}async function l(e){try{let t;let{id:s,status:a,processed:r,published:o,summary:i,metaDescription:u}=await e.json();if(!s)return n.NextResponse.json({success:!1,error:"Missing id"},{status:400});let l=await p.db.getMaterialById(s);if(!l)return n.NextResponse.json({success:!1,error:"Material not found"},{status:404});let c={},d="string"==typeof i?i.trim():void 0;"string"==typeof i&&(c.summary=i),"string"==typeof u&&(c.metaDescription=u);let g="boolean"==typeof r?r:l.processed,m="boolean"==typeof o?o:l.published,h="string"==typeof a&&a.trim().length>0?a.trim():void 0;if(void 0!==d&&(0===d.length?(g=!1,m=!1):g=!0),h)switch(h){case"archived":m=!1;break;case"published":g=!0,m=!0;break;case"processed":g=!0,m=!1;break;case"new":g=!1,m=!1}if(m){if(!(void 0!==d?d:(l.summary??"").trim()))return n.NextResponse.json({success:!1,error:"Нельзя опубликовать материал без саммари"},{status:400});g=!0}t="archived"===h?"archived":"new"===h?"new":"processed"===h?"processed":"published"===h?"published":"archived"===l.status?"archived":m?"published":g?"processed":"new";let b={};if(t!==l.status&&(b.status=t),g!==l.processed&&(b.processed=g),m!==l.published&&(b.published=m),0===Object.keys(b).length&&0===Object.keys(c).length)return n.NextResponse.json({success:!1,error:"No updates were provided"},{status:400});return Object.keys(b).length>0&&await p.db.updateMaterialAttributes(s,b),Object.keys(c).length>0&&await p.db.updateMaterialSummary(s,c),n.NextResponse.json({success:!0,message:"Material updated successfully"})}catch(e){return console.error("API Error:",e),n.NextResponse.json({success:!1,error:"Failed to update material"},{status:500})}}async function c(e){try{let{searchParams:t}=new URL(e.url),s=t.get("id");if(!s)return n.NextResponse.json({success:!1,error:"Missing material ID"},{status:400});return await p.db.deleteMaterial(s),n.NextResponse.json({success:!0,message:"Material deleted successfully"})}catch(e){return console.error("API Error:",e),n.NextResponse.json({success:!1,error:"Failed to delete material"},{status:500})}}let d=new r.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/materials/route",pathname:"/api/materials",filename:"route",bundlePath:"app/api/materials/route"},resolvedPagePath:"/Users/macbookpro/Desktop/syndicateadmin/app/api/materials/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:m,serverHooks:h}=d,b="/api/materials/route";function f(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[948,972,487],()=>s(4460));module.exports=a})();