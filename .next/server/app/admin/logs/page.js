(()=>{var e={};e.id=757,e.ids=[757],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5900:e=>{"use strict";e.exports=require("pg")},9261:e=>{"use strict";e.exports=require("postcss")},2081:e=>{"use strict";e.exports=require("child_process")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1017:e=>{"use strict";e.exports=require("path")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},4099:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>o,routeModule:()=>u,tree:()=>d}),t(377),t(596),t(7489),t(5866);var r=t(3191),a=t(8716),n=t(7922),i=t.n(n),l=t(5231),c={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);t.d(s,c);let d=["",{children:["admin",{children:["logs",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,377)),"/Users/macbookpro/Desktop/syndicateadmin/app/admin/logs/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,596)),"/Users/macbookpro/Desktop/syndicateadmin/app/admin/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,7489)),"/Users/macbookpro/Desktop/syndicateadmin/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}],o=["/Users/macbookpro/Desktop/syndicateadmin/app/admin/logs/page.tsx"],x="/admin/logs/page",m={require:t,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/logs/page",pathname:"/admin/logs",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},4019:(e,s,t)=>{Promise.resolve().then(t.bind(t,3289))},3289:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>N});var r=t(326),a=t(7577),n=t(3796),i=t(2643),l=t(5940),c=t(772),d=t(567),o=t(5304),x=t(3427),m=t(5999),u=t(4674),p=t(770),h=t(9492);let g=(0,t(7926).Z)("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),j=e=>new Date(e).toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),y=e=>"number"==typeof e&&Number.isFinite(e)?`${Math.round(100*e)}%`:"—",b=e=>e.validationCategory&&e.predictedCategory?e.validationCategory===e.predictedCategory?{label:"Подтверждено",variant:"default",icon:r.jsx(u.Z,{className:"h-3.5 w-3.5"})}:{label:"Изменено при проверке",variant:"warning",icon:r.jsx(p.Z,{className:"h-3.5 w-3.5"})}:e.predictedCategory?{label:"Сохранено",variant:"secondary",icon:r.jsx(u.Z,{className:"h-3.5 w-3.5"})}:{label:"Ошибка",variant:"destructive",icon:r.jsx(p.Z,{className:"h-3.5 w-3.5"})},f={default:"bg-primary/10 text-primary border-transparent",secondary:"bg-muted text-foreground border-transparent",warning:"bg-amber-100 text-amber-900 border-transparent dark:bg-amber-400/10 dark:text-amber-300",destructive:"bg-destructive/10 text-destructive border-transparent"},v=e=>{let s=e?.toLowerCase()??"";return"error"===s?"bg-destructive/10 text-destructive border-transparent":"warning"===s||"warn"===s?"bg-amber-100 text-amber-900 border-transparent dark:bg-amber-400/10 dark:text-amber-300":"info"===s?"bg-primary/10 text-primary border-transparent":"bg-muted text-foreground border-transparent"};function N(){let[e,s]=(0,a.useState)("ai"),[t,u]=(0,a.useState)([]),[p,N]=(0,a.useState)(!0),[w,k]=(0,a.useState)(null),[C,P]=(0,a.useState)([]),[q,S]=(0,a.useState)(!0),[_,A]=(0,a.useState)(null),M=(0,a.useCallback)(async()=>{try{N(!0),k(null);let e=await fetch("/api/categorization-logs?limit=100",{cache:"no-store"}),s=await e.json();if(!e.ok||!s.success)throw Error(s.error||"Не удалось загрузить логи");u(s.data??[])}catch(s){let e=s instanceof Error?s.message:"Неожиданная ошибка";k(e),m.Am.error(e)}finally{N(!1)}},[]),Z=(0,a.useCallback)(async()=>{try{S(!0),A(null);let e=await fetch("/api/system-logs?limit=200",{cache:"no-store"}),s=await e.json();if(!e.ok||!s.success)throw Error(s.error||"Не удалось загрузить системные логи");P(s.data??[])}catch(s){let e=s instanceof Error?s.message:"Неожиданная ошибка";A(e),m.Am.error(e)}finally{S(!1)}},[]);return(0,r.jsxs)(r.Fragment,{children:[r.jsx(n.P,{}),r.jsx("div",{className:"min-h-screen bg-background p-8",children:(0,r.jsxs)("div",{className:"container space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[r.jsx("h1",{className:"text-3xl font-bold",children:"Логи системы"}),r.jsx("p",{className:"text-muted-foreground max-w-2xl",children:"Отслеживайте поведение AI и системные ошибки для быстрой диагностики проблем."})]}),(0,r.jsxs)(i.Zb,{children:[(0,r.jsxs)(i.Ol,{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[r.jsx(i.ll,{children:"Логи системы"}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[("ai"===e?p:q)?(0,r.jsxs)("span",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[r.jsx(h.Z,{className:"h-4 w-4 animate-spin"}),"ai"===e?"Обновление логов классификации…":"Обновление системных логов…"]}):null,(0,r.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>{M(),Z()},disabled:p||q,children:[r.jsx(g,{className:"mr-2 h-4 w-4"}),"Обновить"]})]})]}),r.jsx(i.aY,{children:(0,r.jsxs)(x.mQ,{value:e,onValueChange:e=>s(e),className:"space-y-4",children:[(0,r.jsxs)(x.dr,{children:[r.jsx(x.SP,{value:"ai",children:"AI-логи"}),r.jsx(x.SP,{value:"system",children:"Системные ошибки"})]}),(0,r.jsxs)(x.nU,{value:"ai",className:"space-y-4",children:[w&&r.jsx("div",{className:"rounded-md border border-destructive/40 bg-destructive/5 p-3 text-sm text-destructive",children:w}),p&&0===t.length?r.jsx("div",{className:"space-y-2",children:Array.from({length:6}).map((e,s)=>r.jsx(o.O,{className:"h-12 w-full"},`ai-skeleton-${s}`))}):t.length>0?r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)(l.iA,{children:[r.jsx(l.xD,{children:(0,r.jsxs)(l.SC,{children:[r.jsx(l.ss,{className:"w-48",children:"Дата"}),r.jsx(l.ss,{children:"Материал"}),r.jsx(l.ss,{className:"w-40",children:"Категория"}),r.jsx(l.ss,{className:"w-40",children:"Перепроверка"}),r.jsx(l.ss,{className:"w-32 text-center",children:"Уверенность"}),r.jsx(l.ss,{className:"w-32 text-center",children:"Статус"}),r.jsx(l.ss,{className:"w-[320px]",children:"Reasoning"})]})}),r.jsx(l.RM,{children:t.map(e=>{let s=b(e),t=e.metadata?.final_category;return(0,r.jsxs)(l.SC,{children:[r.jsx(l.pj,{className:"align-top text-sm text-muted-foreground",children:j(e.createdAt)}),(0,r.jsxs)(l.pj,{className:"align-top",children:[r.jsx("div",{className:"text-sm font-medium text-foreground break-words",children:e.title||"—"}),(0,r.jsxs)("div",{className:"text-xs text-muted-foreground break-words",children:["ID: ",e.materialId]}),e.supercategory&&(0,r.jsxs)("div",{className:"mt-1 text-xs text-muted-foreground",children:["Надкатегория: ",e.supercategory]})]}),(0,r.jsxs)(l.pj,{className:"align-top text-sm",children:[e.predictedCategory||"—",t&&t!==e.predictedCategory&&(0,r.jsxs)("div",{className:"text-xs text-muted-foreground mt-1",children:["Итоговая: ",t]})]}),(0,r.jsxs)(l.pj,{className:"align-top text-sm",children:[e.validationCategory||"—",null!==e.validationConfidence&&(0,r.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Доверие: ",y(e.validationConfidence)]})]}),r.jsx(l.pj,{className:"align-top text-sm text-center",children:y(e.confidence)}),r.jsx(l.pj,{className:"align-top text-center",children:(0,r.jsxs)(d.C,{variant:"outline",className:f[s.variant]??f.default,children:[r.jsx("span",{className:"mr-1 inline-flex items-center gap-1",children:s.icon}),s.label]})}),r.jsx(l.pj,{className:"align-top text-xs text-muted-foreground",children:e.reasoning?(0,r.jsxs)("details",{className:"space-y-1",children:[r.jsx("summary",{className:"cursor-pointer text-primary",children:"Показать шаги"}),r.jsx("pre",{className:"mt-2 whitespace-pre-wrap rounded-md bg-muted/40 p-3 text-[11px] text-foreground",children:JSON.stringify(e.reasoning,null,2)})]}):r.jsx("span",{children:"—"})})]},e.id)})})]})}):r.jsx("div",{className:"py-16 text-center text-sm text-muted-foreground",children:"Пока нет записей. Запустите генерацию или регенерацию таксономии, чтобы увидеть Reasoning."})]}),(0,r.jsxs)(x.nU,{value:"system",className:"space-y-4",children:[_&&r.jsx("div",{className:"rounded-md border border-destructive/40 bg-destructive/5 p-3 text-sm text-destructive",children:_}),q&&0===C.length?r.jsx("div",{className:"space-y-2",children:Array.from({length:6}).map((e,s)=>r.jsx(o.O,{className:"h-12 w-full"},`system-skeleton-${s}`))}):C.length>0?r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)(l.iA,{children:[r.jsx(l.xD,{children:(0,r.jsxs)(l.SC,{children:[r.jsx(l.ss,{className:"w-48",children:"Дата"}),r.jsx(l.ss,{className:"w-32 text-center",children:"Уровень"}),r.jsx(l.ss,{className:"w-48",children:"Источник"}),r.jsx(l.ss,{children:"Сообщение"}),r.jsx(l.ss,{className:"w-[320px]",children:"Детали"})]})}),r.jsx(l.RM,{children:C.map(e=>(0,r.jsxs)(l.SC,{children:[r.jsx(l.pj,{className:"align-top text-sm text-muted-foreground",children:j(e.createdAt)}),r.jsx(l.pj,{className:"align-top text-center",children:r.jsx(d.C,{variant:"outline",className:v(e.level),children:e.level?.toUpperCase()})}),r.jsx(l.pj,{className:"align-top text-sm break-words",children:e.source||"—"}),(0,r.jsxs)(l.pj,{className:"align-top text-sm break-words",children:[e.message,e.stack&&(0,r.jsxs)("details",{className:"mt-2 text-xs text-muted-foreground",children:[r.jsx("summary",{className:"cursor-pointer text-primary",children:"Стек ошибки"}),r.jsx("pre",{className:"mt-2 whitespace-pre-wrap rounded-md bg-muted/40 p-3 text-[11px] text-foreground",children:e.stack})]})]}),r.jsx(l.pj,{className:"align-top text-xs text-muted-foreground",children:e.details?(0,r.jsxs)("details",{children:[r.jsx("summary",{className:"cursor-pointer text-primary",children:"Показать"}),r.jsx("pre",{className:"mt-2 whitespace-pre-wrap rounded-md bg-muted/40 p-3 text-[11px] text-foreground",children:JSON.stringify(e.details,null,2)})]}):r.jsx("span",{children:"—"})})]},e.id))})]})}):r.jsx("div",{className:"py-16 text-center text-sm text-muted-foreground",children:"Системных ошибок пока не зафиксировано."})]})]})})]})]})})]})}},5047:(e,s,t)=>{"use strict";var r=t(7389);t.o(r,"usePathname")&&t.d(s,{usePathname:function(){return r.usePathname}}),t.o(r,"useRouter")&&t.d(s,{useRouter:function(){return r.useRouter}}),t.o(r,"useSearchParams")&&t.d(s,{useSearchParams:function(){return r.useSearchParams}})},377:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>i,__esModule:()=>n,default:()=>l});var r=t(8570);let a=(0,r.createProxy)(String.raw`/Users/macbookpro/Desktop/syndicateadmin/app/admin/logs/page.tsx`),{__esModule:n,$$typeof:i}=a;a.default;let l=(0,r.createProxy)(String.raw`/Users/macbookpro/Desktop/syndicateadmin/app/admin/logs/page.tsx#default`)},770:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});let r=(0,t(7926).Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},4674:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});let r=(0,t(7926).Z)("CheckCircle2",[["path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z",key:"14v8dr"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},9492:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});let r=(0,t(7926).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},6125:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});let r=(0,t(7926).Z)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]])}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[948,283,896,434,206,594,103],()=>t(4099));module.exports=r})();