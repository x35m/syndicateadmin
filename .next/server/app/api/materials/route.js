"use strict";(()=>{var e={};e.id=6149,e.ids=[6149],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5900:e=>{e.exports=require("pg")},4460:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>f,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>g,serverHooks:()=>b,staticGenerationAsyncStorage:()=>h});var a={};s.r(a),s.d(a,{DELETE:()=>c,GET:()=>u,PATCH:()=>d});var r=s(9303),i=s(8716),o=s(670),n=s(7070),l=s(9487),p=s(7435);async function u(e){let t;try{let s;let{searchParams:a}=new URL(e.url);t=Object.fromEntries(a.entries());let r=a.get("status"),i=a.get("page")?parseInt(a.get("page")):void 0,o=a.get("pageSize")?parseInt(a.get("pageSize")):void 0,p=a.get("search")||void 0,u=a.get("categoryIds")?.split(",").map(Number).filter(Boolean),d=a.get("countryIds")?.split(",").map(Number).filter(Boolean),c=a.get("cityIds")?.split(",").map(Number).filter(Boolean),g=a.get("feedNames")?.split(",").filter(Boolean);if(void 0!==i||void 0!==o||p||u||d||c||g){let e=await l.db.getMaterialsPaginated({page:i,pageSize:o,status:r||void 0,search:p,categoryIds:u,countryIds:d,cityIds:c,feedNames:g}),t=await l.db.getStats();return n.NextResponse.json({success:!0,data:e.materials,pagination:{page:e.page,pageSize:e.pageSize,total:e.total,totalPages:e.totalPages},stats:{total:parseInt(t.total||"0"),new:parseInt(t.new_count||"0"),processed:parseInt(t.processed_count||"0"),published:parseInt(t.published_count||"0"),archived:parseInt(t.archived_count||"0")}})}s=r&&"all"!==r?await l.db.getMaterialsByStatus(r):await l.db.getAllMaterials();let m=await l.db.getStats();return n.NextResponse.json({success:!0,data:s,stats:{total:parseInt(m.total||"0"),new:parseInt(m.new_count||"0"),processed:parseInt(m.processed_count||"0"),published:parseInt(m.published_count||"0"),archived:parseInt(m.archived_count||"0")}})}catch(e){return console.error("API Error:",e),await (0,p.r)("api/materials",e,{method:"GET",query:t}),n.NextResponse.json({success:!1,error:"Failed to fetch materials"},{status:500})}}async function d(e){let t;try{let s;let{id:a,status:r,processed:i,published:o,summary:p,metaDescription:u}=await e.json();if(!a)return n.NextResponse.json({success:!1,error:"Missing id"},{status:400});t=a;let d=await l.db.getMaterialById(a);if(!d)return n.NextResponse.json({success:!1,error:"Material not found"},{status:404});let c={},g="string"==typeof p?p.trim():void 0;"string"==typeof p&&(c.summary=p),"string"==typeof u&&(c.metaDescription=u);let m="boolean"==typeof i?i:d.processed,h="boolean"==typeof o?o:d.published,b="string"==typeof r&&r.trim().length>0?r.trim():void 0;if(void 0!==g&&(0===g.length?(m=!1,h=!1):m=!0),b)switch(b){case"archived":h=!1;break;case"published":m=!0,h=!0;break;case"processed":m=!0,h=!1;break;case"new":m=!1,h=!1}if(h){if(!(void 0!==g?g:(d.summary??"").trim()))return n.NextResponse.json({success:!1,error:"Нельзя опубликовать материал без саммари"},{status:400});m=!0}s="archived"===b?"archived":"new"===b?"new":"processed"===b?"processed":"published"===b?"published":"archived"===d.status?"archived":h?"published":m?"processed":"new";let f={};if(s!==d.status&&(f.status=s),m!==d.processed&&(f.processed=m),h!==d.published&&(f.published=h),0===Object.keys(f).length&&0===Object.keys(c).length)return n.NextResponse.json({success:!1,error:"No updates were provided"},{status:400});return Object.keys(f).length>0&&await l.db.updateMaterialAttributes(a,f),Object.keys(c).length>0&&await l.db.updateMaterialSummary(a,c),n.NextResponse.json({success:!0,message:"Material updated successfully"})}catch(e){return console.error("API Error:",e),await (0,p.r)("api/materials",e,{method:"PATCH",id:t}),n.NextResponse.json({success:!1,error:"Failed to update material"},{status:500})}}async function c(e){let t=null;try{let{searchParams:s}=new URL(e.url),a=s.get("id");if(t=a,!a)return n.NextResponse.json({success:!1,error:"Missing material ID"},{status:400});return await l.db.deleteMaterial(a),n.NextResponse.json({success:!0,message:"Material deleted successfully"})}catch(e){return console.error("API Error:",e),await (0,p.r)("api/materials",e,{method:"DELETE",id:t??void 0}),n.NextResponse.json({success:!1,error:"Failed to delete material"},{status:500})}}let g=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/materials/route",pathname:"/api/materials",filename:"route",bundlePath:"app/api/materials/route"},resolvedPagePath:"/Users/macbookpro/Desktop/syndicateadmin/app/api/materials/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:b}=g,f="/api/materials/route";function v(){return(0,o.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:h})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[8948,5972,7435],()=>s(4460));module.exports=a})();