(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[757],{1100:function(e,t,r){Promise.resolve().then(r.bind(r,6557))},6557:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return j}});var a=r(7437),s=r(2265),n=r(6219),i=r(6013),l=r(6975),d=r(495),o=r(4693),c=r(2738),u=r(7776),m=r(2023),f=r(279),x=r(1154);let h=(0,r(7934).Z)("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),p=e=>new Date(e).toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),g=e=>"number"==typeof e&&Number.isFinite(e)?"".concat(Math.round(100*e),"%"):"—",b=e=>e.validationCategory&&e.predictedCategory?e.validationCategory===e.predictedCategory?{label:"Подтверждено",variant:"default",icon:(0,a.jsx)(m.Z,{className:"h-3.5 w-3.5"})}:{label:"Изменено при проверке",variant:"warning",icon:(0,a.jsx)(f.Z,{className:"h-3.5 w-3.5"})}:e.predictedCategory?{label:"Сохранено",variant:"secondary",icon:(0,a.jsx)(m.Z,{className:"h-3.5 w-3.5"})}:{label:"Ошибка",variant:"destructive",icon:(0,a.jsx)(f.Z,{className:"h-3.5 w-3.5"})},v={default:"bg-primary/10 text-primary border-transparent",secondary:"bg-muted text-foreground border-transparent",warning:"bg-amber-100 text-amber-900 border-transparent dark:bg-amber-400/10 dark:text-amber-300",destructive:"bg-destructive/10 text-destructive border-transparent"};function j(){let[e,t]=(0,s.useState)([]),[r,m]=(0,s.useState)(!0),[f,j]=(0,s.useState)(null),y=(0,s.useCallback)(async()=>{try{var e;m(!0),j(null);let r=await fetch("/api/categorization-logs?limit=100",{cache:"no-store"}),a=await r.json();if(!r.ok||!a.success)throw Error(a.error||"Не удалось загрузить логи");t(null!==(e=a.data)&&void 0!==e?e:[])}catch(t){let e=t instanceof Error?t.message:"Неожиданная ошибка";j(e),u.Am.error(e)}finally{m(!1)}},[]);(0,s.useEffect)(()=>{y()},[y]);let N=e.length>0;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.P,{}),(0,a.jsx)("div",{className:"min-h-screen bg-background p-8",children:(0,a.jsxs)("div",{className:"container space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Логи классификации"}),(0,a.jsx)("p",{className:"text-muted-foreground max-w-2xl",children:"История решений нейросети по присвоению категорий с пошаговым reasoning и результатами перепроверки."})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsx)(i.ll,{children:"Последние операции"}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[r?(0,a.jsxs)("span",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsx)(x.Z,{className:"h-4 w-4 animate-spin"}),"Обновление..."]}):null,(0,a.jsxs)(d.z,{variant:"outline",size:"sm",onClick:y,disabled:r,children:[(0,a.jsx)(h,{className:"mr-2 h-4 w-4"}),"Обновить"]})]})]}),(0,a.jsxs)(i.aY,{children:[f&&(0,a.jsx)("div",{className:"mb-4 rounded-md border border-destructive/40 bg-destructive/5 p-3 text-sm text-destructive",children:f}),r&&!N?(0,a.jsx)("div",{className:"space-y-2",children:Array.from({length:6}).map((e,t)=>(0,a.jsx)(c.O,{className:"h-12 w-full"},t))}):N?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(l.iA,{children:[(0,a.jsx)(l.xD,{children:(0,a.jsxs)(l.SC,{children:[(0,a.jsx)(l.ss,{className:"w-48",children:"Дата"}),(0,a.jsx)(l.ss,{children:"Материал"}),(0,a.jsx)(l.ss,{className:"w-40",children:"Категория"}),(0,a.jsx)(l.ss,{className:"w-40",children:"Перепроверка"}),(0,a.jsx)(l.ss,{className:"w-32 text-center",children:"Уверенность"}),(0,a.jsx)(l.ss,{className:"w-32 text-center",children:"Статус"}),(0,a.jsx)(l.ss,{className:"w-[320px]",children:"Reasoning"})]})}),(0,a.jsx)(l.RM,{children:e.map(e=>{var t,r;let s=b(e),n=null===(t=e.metadata)||void 0===t?void 0:t.final_category;return(0,a.jsxs)(l.SC,{children:[(0,a.jsx)(l.pj,{className:"align-top text-sm text-muted-foreground",children:p(e.createdAt)}),(0,a.jsxs)(l.pj,{className:"align-top",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-foreground break-words",children:e.title||"—"}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground break-words",children:["ID: ",e.materialId]}),e.supercategory&&(0,a.jsxs)("div",{className:"mt-1 text-xs text-muted-foreground",children:["Надкатегория: ",e.supercategory]})]}),(0,a.jsxs)(l.pj,{className:"align-top text-sm",children:[e.predictedCategory||"—",n&&n!==e.predictedCategory&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground mt-1",children:["Итоговая: ",n]})]}),(0,a.jsxs)(l.pj,{className:"align-top text-sm",children:[e.validationCategory||"—",null!==e.validationConfidence&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Доверие: ",g(e.validationConfidence)]})]}),(0,a.jsx)(l.pj,{className:"align-top text-sm text-center",children:g(e.confidence)}),(0,a.jsx)(l.pj,{className:"align-top text-center",children:(0,a.jsxs)(o.C,{variant:"outline",className:null!==(r=v[s.variant])&&void 0!==r?r:v.default,children:[(0,a.jsx)("span",{className:"mr-1 inline-flex items-center gap-1",children:s.icon}),s.label]})}),(0,a.jsx)(l.pj,{className:"align-top text-xs text-muted-foreground",children:e.reasoning?(0,a.jsxs)("details",{className:"space-y-1",children:[(0,a.jsx)("summary",{className:"cursor-pointer text-primary",children:"Показать шаги"}),(0,a.jsx)("pre",{className:"mt-2 whitespace-pre-wrap rounded-md bg-muted/40 p-3 text-[11px] text-foreground",children:JSON.stringify(e.reasoning,null,2)})]}):(0,a.jsx)("span",{children:"—"})})]},e.id)})})]})}):(0,a.jsx)("div",{className:"py-16 text-center text-sm text-muted-foreground",children:"Пока нет записей. Запустите генерацию или регенерацию таксономии, чтобы увидеть Reasoning."})]})]})]})})]})}},6219:function(e,t,r){"use strict";r.d(t,{P:function(){return c}});var a=r(7437),s=r(7138),n=r(6463),i=r(7440),l=r(495),d=r(1663),o=r(7776);function c(){let e=(0,n.usePathname)(),t=(0,n.useRouter)(),r=async()=>{try{(await fetch("/api/admin/logout",{method:"POST"})).ok&&(o.Am.success("Вы вышли из системы"),t.push("/admin/login"),t.refresh())}catch(e){console.error("Logout error:",e),o.Am.error("Ошибка при выходе")}};return(0,a.jsx)("header",{className:"sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:(0,a.jsxs)("div",{className:"container flex h-16 items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex gap-6 md:gap-10",children:[(0,a.jsx)(s.default,{href:"/admin",className:"flex items-center space-x-2",children:(0,a.jsxs)("span",{className:"text-xl font-bold tracking-tight",children:["SYNDICATE ",(0,a.jsx)("span",{className:"text-primary",children:"admin"})]})}),(0,a.jsx)("nav",{className:"flex items-center gap-6",children:[{href:"/admin",label:"Дашборд"},{href:"/admin/materials",label:"Материалы"},{href:"/admin/rss",label:"RSS фиды"},{href:"/admin/taxonomy",label:"Справочники"},{href:"/admin/logs",label:"Логи AI"},{href:"/admin/settings",label:"Настройки"}].map(t=>(0,a.jsx)(s.default,{href:t.href,className:(0,i.cn)("text-sm font-medium transition-colors hover:text-primary",e===t.href?"text-foreground":"text-muted-foreground"),children:t.label},t.href))})]}),(0,a.jsxs)(l.z,{variant:"ghost",size:"sm",onClick:r,children:[(0,a.jsx)(d.Z,{className:"mr-2 h-4 w-4"}),"Выход"]})]})})}},4693:function(e,t,r){"use strict";r.d(t,{C:function(){return l}});var a=r(7437);r(2265);var s=r(3027),n=r(7440);let i=(0,s.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:r,...s}=e;return(0,a.jsx)("div",{className:(0,n.cn)(i({variant:r}),t),...s})}},495:function(e,t,r){"use strict";r.d(t,{d:function(){return d},z:function(){return o}});var a=r(7437),s=r(2265),n=r(1538),i=r(3027),l=r(7440);let d=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=s.forwardRef((e,t)=>{let{className:r,variant:s,size:i,asChild:o=!1,...c}=e,u=o?n.g7:"button";return(0,a.jsx)(u,{className:(0,l.cn)(d({variant:s,size:i,className:r})),ref:t,...c})});o.displayName="Button"},6013:function(e,t,r){"use strict";r.d(t,{Ol:function(){return l},SZ:function(){return o},Zb:function(){return i},aY:function(){return c},ll:function(){return d}});var a=r(7437),s=r(2265),n=r(7440);let i=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});i.displayName="Card";let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...s})});l.displayName="CardHeader";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});d.displayName="CardTitle";let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",r),...s})});o.displayName="CardDescription";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",r),...s})});c.displayName="CardContent",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",r),...s})}).displayName="CardFooter"},2738:function(e,t,r){"use strict";r.d(t,{O:function(){return n}});var a=r(7437),s=r(7440);function n(e){let{className:t,...r}=e;return(0,a.jsx)("div",{className:(0,s.cn)("animate-pulse rounded-md bg-muted",t),...r})}},6975:function(e,t,r){"use strict";r.d(t,{RM:function(){return d},SC:function(){return o},iA:function(){return i},pj:function(){return u},ss:function(){return c},xD:function(){return l}});var a=r(7437),s=r(2265),n=r(7440);let i=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:t,className:(0,n.cn)("w-full caption-bottom text-sm",r),...s})})});i.displayName="Table";let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("thead",{ref:t,className:(0,n.cn)("[&_tr]:border-b",r),...s})});l.displayName="TableHeader";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("tbody",{ref:t,className:(0,n.cn)("[&_tr:last-child]:border-0",r),...s})});d.displayName="TableBody",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("tfoot",{ref:t,className:(0,n.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...s})}).displayName="TableFooter";let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("tr",{ref:t,className:(0,n.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...s})});o.displayName="TableRow";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("th",{ref:t,className:(0,n.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...s})});c.displayName="TableHead";let u=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("td",{ref:t,className:(0,n.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...s})});u.displayName="TableCell",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("caption",{ref:t,className:(0,n.cn)("mt-4 text-sm text-muted-foreground",r),...s})}).displayName="TableCaption"},7440:function(e,t,r){"use strict";r.d(t,{cn:function(){return n}});var a=r(4839),s=r(6164);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.m6)((0,a.W)(t))}},6463:function(e,t,r){"use strict";var a=r(1169);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},279:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(7934).Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},2023:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(7934).Z)("CheckCircle2",[["path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z",key:"14v8dr"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},1154:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(7934).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},1663:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(7934).Z)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]])}},function(e){e.O(0,[876,776,138,971,23,744],function(){return e(e.s=1100)}),_N_E=e.O()}]);