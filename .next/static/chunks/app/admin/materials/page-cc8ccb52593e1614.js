(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[227],{1377:function(e,s,t){Promise.resolve().then(t.bind(t,1470))},1470:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return V}});var a=t(7437),n=t(2265),l=t(495),r=t(6013),i=t(6975),c=t(4693),d=t(837),o=t(6780),m=t(5273),u=t(6466),x=t(2738),h=t(3102),f=t(3146),g=t(7135),p=t(4602),j=t(1154),v=t(279),y=t(2023),N=t(6746),b=t(5704),w=t(2083),C=t(4166),k=t(4920),S=t(3925),z=t(7785),I=t(1172),A=t(9346),E=t(664),O=t(870),Z=t(2790),R=t(6219),T=t(7776),_=t(6910);let M={search:"",categories:[],countries:[],cities:[],feeds:[]},P={"generate-summary":{label:"Генерация саммари",successMessage:"Генерация завершена успешно"},published:{label:"Публикация",successMessage:"Публикация завершена успешно"},archived:{label:"Архивирование",successMessage:"Архивирование завершено"},delete:{label:"Удаление",successMessage:"Удаление завершено"}};function D(e){let{label:s,options:t,selected:r,onChange:i,disabled:d,fullWidth:o,maxSelected:m}=e,[u,x]=(0,n.useState)(""),f=e=>{if(r.includes(e))i(r.filter(s=>s!==e));else if(m&&m>0){if(1===m)i([e]);else{let s=[...r,e],t=s.length-m;t>0&&s.splice(0,t),i(s)}}else i([...r,e])},g=(0,n.useMemo)(()=>{let e=u.trim().toLowerCase();return e?t.filter(s=>s.label.toLowerCase().includes(e)):t},[t,u]);return(0,a.jsxs)(_.h_,{onOpenChange:e=>!e&&x(""),children:[(0,a.jsx)(_.$F,{asChild:!0,disabled:d,children:(0,a.jsxs)(l.z,{variant:"outline",size:"sm",className:"".concat(o?"w-full":"min-w-[180px]"," justify-between"),children:[(0,a.jsxs)("span",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("span",{children:s}),r.length>0&&(0,a.jsx)(c.C,{variant:"secondary",className:"px-1 text-xs font-medium",children:r.length})]}),(0,a.jsx)(p.Z,{className:"h-3 w-3 text-muted-foreground"})]})}),(0,a.jsxs)(_.AW,{align:"start",className:"".concat(o?"w-80":"w-64"," max-h-64 overflow-y-auto"),children:[(0,a.jsx)(_.Ju,{children:s}),(0,a.jsx)(_.VD,{}),(0,a.jsx)("div",{className:"p-1",children:(0,a.jsx)(h.I,{placeholder:"Поиск...",value:u,onChange:e=>x(e.target.value),className:"h-8"})}),(0,a.jsx)(_.VD,{}),0===g.length?(0,a.jsx)("div",{className:"px-2 py-1.5 text-xs text-muted-foreground",children:"Ничего не найдено"}):g.map(e=>(0,a.jsx)(_.bO,{checked:r.includes(e.value),onCheckedChange:()=>f(e.value),children:e.label},String(e.value)))]})]})}function V(){let[e,s]=(0,n.useState)([]),[t,p]=(0,n.useState)(!0),[_,V]=(0,n.useState)("all"),[F,J]=(0,n.useState)(null),[L,Y]=(0,n.useState)(!1),[q,H]=(0,n.useState)(!1),[U,W]=(0,n.useState)(new Set),[$,X]=(0,n.useState)(null),B=(0,n.useRef)(!1),[Q,K]=(0,n.useState)(null),[G,ee]=(0,n.useState)({total:0,new:0,processed:0,published:0,archived:0}),[es,et]=(0,n.useState)(1),[ea,en]=(0,n.useState)(50),[el,er]=(0,n.useState)(1),[ei,ec]=(0,n.useState)(0),[ed,eo]=(0,n.useState)({categories:[],countries:[]}),[em,eu]=(0,n.useState)(!1),[ex,eh]=(0,n.useState)(M),[ef,eg]=(0,n.useState)(!1),[ep,ej]=(0,n.useState)(!1),[ev,ey]=(0,n.useState)(null),[eN,eb]=(0,n.useState)({category:"",country:"",city:""}),[ew,eC]=(0,n.useState)({categoryIds:[],countryIds:[],cityIds:[]}),[ek,eS]=(0,n.useState)(""),[ez,eI]=(0,n.useState)(""),[eA,eE]=(0,n.useState)(!1),eO=(0,n.useMemo)(()=>{let s=new Set;return e.forEach(e=>{let t=e.feedName||e.source;t&&s.add(t)}),Array.from(s).sort((e,s)=>e.localeCompare(s,"ru"))},[e]),eZ=(0,n.useMemo)(()=>{let e=[];return ed.countries.forEach(s=>{s.cities.forEach(t=>{e.push({value:t.id,label:"".concat(t.name," — ").concat(s.name)})})}),e.sort((e,s)=>e.label.localeCompare(s.label,"ru"))},[ed.countries]),eR=(0,n.useMemo)(()=>{var e,s;return!!F&&(ek!==(null!==(e=F.summary)&&void 0!==e?e:"")||ez!==(null!==(s=F.metaDescription)&&void 0!==s?s:""))},[F,ek,ez]),eT=(0,n.useMemo)(()=>ex.search.trim().length>0||ex.categories.length>0||ex.countries.length>0||ex.cities.length>0||ex.feeds.length>0,[ex]),e_=(0,n.useCallback)(async function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:es,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=null!==(e=n.silent)&&void 0!==e&&e;l||p(!0);try{let e=new URLSearchParams;e.set("status",t),e.set("page",a.toString()),e.set("pageSize",ea.toString()),ex.search&&e.set("search",ex.search),ex.categories.length>0&&e.set("categoryIds",ex.categories.join(",")),ex.countries.length>0&&e.set("countryIds",ex.countries.join(",")),ex.cities.length>0&&e.set("cityIds",ex.cities.join(",")),ex.feeds.length>0&&e.set("feedNames",ex.feeds.join(","));let n=await fetch("/api/materials?".concat(e.toString())),l=await n.json();l.success&&(s(l.data),l.pagination&&(er(l.pagination.totalPages),ec(l.pagination.total),et(l.pagination.page)),ee(l.stats||{total:0,new:0,processed:0,published:0,archived:0}))}catch(e){console.error("Error fetching materials:",e)}finally{l||p(!1)}},[ex,ea,es]),eM=(0,n.useCallback)(async(e,s)=>{let t=await fetch("/api/materials",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,...s})}),a=await t.json();if(!t.ok||!a.success)throw Error(a.error||"Не удалось обновить материал")},[]);(0,n.useEffect)(()=>{et(1),W(new Set)},[ex,_]),(0,n.useEffect)(()=>{L||H(!1)},[L]),(0,n.useEffect)(()=>{e_(_,es)},[e_,_,es]),(0,n.useEffect)(()=>{let e=new EventSource("/api/materials/stream?status=".concat(_));return e.onmessage=e=>{try{let n=JSON.parse(e.data);if("new-material"===n.type){let e=n.data,l=!0;if(ex.categories.length>0){var t,a;let s=null!==(a=null===(t=e.categories)||void 0===t?void 0:t.map(e=>e.id))&&void 0!==a?a:[];ex.categories.some(e=>s.includes(e))||(l=!1)}if(l&&ex.countries.length>0){let s=Array.isArray(e.countries)?e.countries.map(e=>e.id):[];ex.countries.some(e=>s.includes(e))||(l=!1)}if(l&&ex.cities.length>0){let s=Array.isArray(e.cities)?e.cities.map(e=>e.id):[];ex.cities.some(e=>s.includes(e))||(l=!1)}if(l&&ex.feeds.length>0){let s=e.feedName||e.source||"";ex.feeds.includes(s)||(l=!1)}if(l&&ex.search.trim()){let s=ex.search.trim().toLowerCase();[e.title,e.summary,e.content,e.feedName,e.source].filter(Boolean).join(" ").toLowerCase().includes(s)||(l=!1)}l&&"all"!==_&&("new"===_&&"new"!==e.status?l=!1:"processed"===_&&"processed"!==e.status?l=!1:"published"===_&&"published"!==e.status?l=!1:"archived"===_&&"archived"!==e.status?l=!1:["processed","published","archived","new"].includes(_)||e.status===_||(l=!1)),l&&(1===es?(s(s=>[e,...s].slice(0,ea)),ec(e=>e+1)):e_(_,es))}else"sync-complete"===n.type&&e_(_,es)}catch(e){console.error("Error parsing SSE message:",e)}},e.onerror=s=>{console.error("SSE connection error:",s),setTimeout(()=>{e.close()},5e3)},()=>{e.close()}},[_,ex,es,ea,e_]);let eP=async()=>{try{eu(!0);let t=await fetch("/api/taxonomy"),a=await t.json();if(a.success){var e,s;eo({categories:null!==(e=a.categories)&&void 0!==e?e:[],countries:null!==(s=a.countries)&&void 0!==s?s:[]})}else T.Am.error(a.error||"Не удалось загрузить таксономию")}catch(e){console.error("Error fetching taxonomy:",e),T.Am.error("Не удалось загрузить таксономию")}finally{eu(!1)}},eD=e=>{if(null==$?void 0:$.running){T.Am.info("Дождитесь завершения текущего процесса");return}if(0===U.size){T.Am.warning("Выберите материалы для обработки");return}K(e)},eV=(0,n.useCallback)(async()=>{if(!Q)return;let s=Array.from(U);if(0===s.length){K(null),T.Am.warning("Нет выбранных материалов для обработки");return}K(null);let t=P[Q];X({action:Q,label:t.label,total:s.length,completed:0,success:0,failed:0,running:!0,stopRequested:!1,message:"Запуск...",errors:[]}),B.current=!1;let a=new Map(e.map(e=>[e.id,e])),n=[],l=0,r=0,i=0,c=e=>{X(s=>s?{...s,...e}:s)},d=e=>{c({completed:i,success:l,failed:r,message:e})},o=async(e,s)=>{await eM(e,s)};try{var m,u,x,h,f,g,p,j;if("generate-summary"===Q){for(let e of s){if(B.current){c({message:"Остановка запрошена. Завершаем процесс..."});break}let t=a.get(e);d("Генерация саммари: ".concat(null!==(m=null==t?void 0:t.title)&&void 0!==m?m:e));try{let s=await fetch("/api/materials/generate-summary",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({materialId:e})}),t=await s.json();if(!s.ok||!t.success)throw Error(t.error||"Не удалось сгенерировать саммари");l++}catch(s){r++,n.push({id:e,title:null!==(x=null===(u=a.get(e))||void 0===u?void 0:u.title)&&void 0!==x?x:e,message:s instanceof Error?s.message:String(s)})}i++,d("Обработано ".concat(i,"/").concat(s.length))}l>0&&await eP()}else if("delete"===Q)for(let e of s){if(B.current){c({message:"Остановка запрошена. Завершаем процесс..."});break}let t=a.get(e);d("Удаление: ".concat(null!==(h=null==t?void 0:t.title)&&void 0!==h?h:e));try{let s=await fetch("/api/materials?id=".concat(e),{method:"DELETE"});if(!s.ok){let e=await s.json().catch(()=>null);throw Error((null==e?void 0:e.error)||"Не удалось удалить материал")}l++}catch(s){r++,n.push({id:e,title:null!==(f=null==t?void 0:t.title)&&void 0!==f?f:e,message:s instanceof Error?s.message:String(s)})}i++,d("Обработано ".concat(i,"/").concat(s.length))}else if("archived"===Q)for(let e of s){if(B.current){c({message:"Остановка запрошена. Завершаем процесс..."});break}let t=a.get(e);d("Архивирование: ".concat(null!==(g=null==t?void 0:t.title)&&void 0!==g?g:e));try{await o(e,{status:"archived",published:!1}),l++}catch(s){r++,n.push({id:e,title:null!==(p=null==t?void 0:t.title)&&void 0!==p?p:e,message:s instanceof Error?s.message:String(s)})}i++,d("Обработано ".concat(i,"/").concat(s.length))}else if("published"===Q)for(let e of s){if(B.current){c({message:"Остановка запрошена. Завершаем процесс..."});break}let t=a.get(e);if(d("Публикация: ".concat(null!==(j=null==t?void 0:t.title)&&void 0!==j?j:e)),!t){r++,n.push({id:e,title:e,message:"Материал не найден в текущем списке"}),i++,d("Обработано ".concat(i,"/").concat(s.length));continue}if(!t.summary||0===t.summary.trim().length){r++,n.push({id:e,title:t.title,message:"У материала отсутствует саммари, публикация невозможна"}),i++,d("Обработано ".concat(i,"/").concat(s.length));continue}try{await o(e,{published:!0}),l++}catch(s){r++,n.push({id:e,title:t.title,message:s instanceof Error?s.message:String(s)})}i++,d("Обработано ".concat(i,"/").concat(s.length))}}catch(e){n.push({id:"system",title:"Системная ошибка",message:e instanceof Error?e.message:String(e)})}finally{await e_(_,es,{silent:!0}),W(new Set);let e=B.current;B.current=!1;let a=s.length,d=i,o=l,m=r,u="";u=e&&d<a?"Процесс остановлен пользователем. Обработано ".concat(d," из ").concat(a,"."):0===m?"".concat(t.successMessage,". Обработано ").concat(o," из ").concat(a,"."):0===o?"Не удалось выполнить действие. Ошибок: ".concat(m,"."):"Выполнено с ошибками: успешно ".concat(o,", ошибок ").concat(m,"."),c({running:!1,stopRequested:e,completed:d,success:o,failed:m,message:u,errors:n}),e&&d<a?(0,T.Am)(u):0===m?T.Am.success(u):T.Am.warning(u)}},[Q,U,e,_,es,e_,eP,eM]),eF=async e=>{V(e),eh(M),await e_(e),W(new Set),et(1)},eJ=e=>{var s,t,a,n,l,r,i;J(e),eC({categoryIds:(null===(s=e.categories)||void 0===s?void 0:s.length)?[e.categories[0].id]:[],countryIds:null!==(n=null===(t=e.countries)||void 0===t?void 0:t.map(e=>e.id))&&void 0!==n?n:[],cityIds:null!==(l=null===(a=e.cities)||void 0===a?void 0:a.map(e=>e.id))&&void 0!==l?l:[]}),eS(null!==(r=e.summary)&&void 0!==r?r:""),eI(null!==(i=e.metaDescription)&&void 0!==i?i:""),H(!1),Y(!0)},eL=(es-1)*ea,eY=eL+e.length,eq=e=>{et(Math.max(1,Math.min(e,el)))},eH=e=>{en(e),et(1)},eU=e=>{if(null==$?void 0:$.running)return;let s=new Set(U);s.has(e)?s.delete(e):s.add(e),W(s)},eW=(e,s)=>{eC(t=>{let a=new Set(t[e]);return a.delete(s),{...t,[e]:Array.from(a)}})},e$=e=>{eC(s=>({...s,[e]:[]}))},eX=e=>s=>{eb(t=>({...t,[e]:s.target.value}))},eB=async e=>{let s=eN[e];if(!s.trim()){T.Am.warning("Введите название");return}if("city"===e){if(0===ew.countryIds.length){T.Am.warning("Выберите хотя бы одну страну перед добавлением города");return}let t=ew.countryIds[0];try{ey(e);let a=await fetch("/api/taxonomy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:e,name:s,countryId:t})}),n=await a.json();if(!n.success){T.Am.error(n.error||"Не удалось создать элемент");return}await eP(),eC(e=>({...e,cityIds:Array.from(new Set([...e.cityIds,n.data.id]))})),eb(s=>({...s,[e]:""})),T.Am.success("Элемент создан")}catch(e){console.error("Error creating taxonomy item:",e),T.Am.error("Ошибка при создании элемента")}finally{ey(null)}return}try{ey(e);let t=await fetch("/api/taxonomy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:e,name:s})}),a=await t.json();if(!a.success){T.Am.error(a.error||"Не удалось создать элемент");return}switch(await eP(),e){case"category":eC(e=>({...e,categoryIds:[a.data.id]}));break;case"country":eC(e=>({...e,countryIds:Array.from(new Set([...e.countryIds,a.data.id]))}))}eb(s=>({...s,[e]:""})),T.Am.success("Элемент создан")}catch(e){console.error("Error creating taxonomy item:",e),T.Am.error("Ошибка при создании элемента")}finally{ey(null)}},eQ=async()=>{if(F)try{eE(!0),eg(!0);let r=[];eR&&r.push(eM(F.id,{summary:ek,metaDescription:ez})),r.push(fetch("/api/materials/taxonomy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({materialId:F.id,categoryIds:ew.categoryIds.slice(0,1),countryIds:ew.countryIds,cityIds:ew.cityIds})}).then(async e=>{let s=await e.json();if(!e.ok||!s.success)throw Error(s.error||"Не удалось сохранить таксономию");return s.data}));let[,i]=await Promise.all(r);if(i){var e,t,a,n,l;s(e=>e.map(e=>e.id===i.id?i:e)),J({...i,summary:ek,metaDescription:ez}),eC({categoryIds:(null===(e=i.categories)||void 0===e?void 0:e.length)?[i.categories[0].id]:[],countryIds:null!==(n=null===(t=i.countries)||void 0===t?void 0:t.map(e=>e.id))&&void 0!==n?n:[],cityIds:null!==(l=null===(a=i.cities)||void 0===a?void 0:a.map(e=>e.id))&&void 0!==l?l:[]})}else J(e=>e&&e.id===F.id?{...e,summary:ek,metaDescription:ez}:e);await e_(_,es,{silent:!0}),T.Am.success("Материал сохранён")}catch(e){console.error("Error saving material:",e),T.Am.error("Не удалось сохранить материал")}finally{eE(!1),eg(!1)}},eK=async()=>{if(F)try{var e,t,a,n,l,r,i,c;ej(!0);let d=await fetch("/api/materials/regenerate-taxonomy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({materialId:F.id})}),o=await d.json();if(!d.ok)throw Error(o.error||"Ошибка при регенерации таксономии");if(o.success&&(null===(e=o.data)||void 0===e?void 0:e.material)){let e=o.data.material;J(e),eS(null!==(l=e.summary)&&void 0!==l?l:""),eI(null!==(r=e.metaDescription)&&void 0!==r?r:""),eC({categoryIds:(null===(t=e.categories)||void 0===t?void 0:t.length)?[e.categories[0].id]:[],countryIds:null!==(i=null===(a=e.countries)||void 0===a?void 0:a.map(e=>e.id))&&void 0!==i?i:[],cityIds:null!==(c=null===(n=e.cities)||void 0===n?void 0:n.map(e=>e.id))&&void 0!==c?c:[]}),s(s=>s.map(s=>s.id===e.id?e:s)),T.Am.success("Таксономия успешно обновлена"),await eP()}}catch(e){console.error("Error regenerating taxonomy:",e),T.Am.error(e.message||"Ошибка при регенерации таксономии")}finally{ej(!1)}},eG=e=>{switch(e){case"new":return(0,a.jsx)(c.C,{variant:"default",children:"Новый"});case"processed":return(0,a.jsx)(c.C,{variant:"secondary",className:"bg-green-500/10 text-green-700 dark:text-green-400",children:"Обработан"});case"published":return(0,a.jsx)(c.C,{variant:"secondary",className:"bg-blue-500/10 text-blue-700 dark:text-blue-400",children:"Опубликован"});case"archived":return(0,a.jsx)(c.C,{variant:"outline",children:"Архив"});default:return(0,a.jsx)(c.C,{children:e})}},e0=e=>{let s=new Date(e),t=String(s.getDate()).padStart(2,"0"),a=String(s.getMonth()+1).padStart(2,"0"),n=String(s.getFullYear()).slice(-2),l=String(s.getHours()).padStart(2,"0"),r=String(s.getMinutes()).padStart(2,"0");return"".concat(t,".").concat(a,".").concat(n," ").concat(l,":").concat(r)},e1=(()=>{let e=U.size;switch(Q){case"published":return{title:"Опубликовать материалы",description:"Вы уверены, что хотите опубликовать ".concat(e," материал(ов)?"),actionText:"Опубликовать",variant:"default"};case"archived":return{title:"Архивировать материалы",description:"Вы уверены, что хотите архивировать ".concat(e," материал(ов)?"),actionText:"Архивировать",variant:"default"};case"delete":return{title:"Удалить материалы",description:"Вы уверены, что хотите удалить ".concat(e," материал(ов)? Это действие необратимо!"),actionText:"Удалить",variant:"destructive"};case"generate-summary":return{title:"Генерация саммари",description:1===e?"Сгенерировать саммари для этого материала?":"Сгенерировать саммари для ".concat(e," материалов?"),actionText:"Сгенерировать",variant:"default"};default:return null}})();return(0,n.useEffect)(()=>{(async()=>{await e_("all"),await eP()})()},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(R.P,{}),(0,a.jsx)("div",{className:"min-h-screen bg-background p-8",children:(0,a.jsxs)("div",{className:"container space-y-6",children:[(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsx)(m.mQ,{value:_,onValueChange:eF,children:(0,a.jsxs)(m.dr,{children:[(0,a.jsxs)(m.SP,{value:"all",children:["Все ",G.total>0&&(0,a.jsxs)("span",{className:"ml-1.5 text-xs",children:["(",G.total,")"]})]}),(0,a.jsxs)(m.SP,{value:"new",children:["Новые ",G.new>0&&(0,a.jsxs)("span",{className:"ml-1.5 text-xs",children:["(",G.new,")"]})]}),(0,a.jsxs)(m.SP,{value:"processed",children:["Обработанные ",G.processed>0&&(0,a.jsxs)("span",{className:"ml-1.5 text-xs",children:["(",G.processed,")"]})]}),(0,a.jsxs)(m.SP,{value:"published",children:["Опубликованные ",G.published>0&&(0,a.jsxs)("span",{className:"ml-1.5 text-xs",children:["(",G.published,")"]})]}),(0,a.jsxs)(m.SP,{value:"archived",children:["Архив ",G.archived>0&&(0,a.jsxs)("span",{className:"ml-1.5 text-xs",children:["(",G.archived,")"]})]})]})})}),$?(0,a.jsx)("div",{className:"fixed bottom-8 left-1/2 -translate-x-1/2 z-50 animate-in slide-in-from-bottom-4 fade-in duration-300 w-[min(90vw,600px)]",children:(0,a.jsx)(r.Zb,{className:"border-primary shadow-2xl",children:(0,a.jsxs)(r.aY,{className:"py-4 px-6 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-semibold",children:$.label}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:$.message}),(0,a.jsxs)("p",{className:"mt-2 text-xs text-muted-foreground",children:["Выполнено ",$.completed," из ",$.total,". Успешно ",$.success,", ошибок ",$.failed,"."]})]}),(0,a.jsx)("div",{className:"flex items-center justify-center rounded-full border bg-background p-2",children:$.running?(0,a.jsx)(j.Z,{className:"h-4 w-4 animate-spin text-primary"}):$.failed>0?(0,a.jsx)(v.Z,{className:"h-4 w-4 text-amber-500"}):(0,a.jsx)(y.Z,{className:"h-4 w-4 text-green-500"})})]}),(0,a.jsx)("div",{className:"h-2 w-full rounded-full bg-muted",children:(0,a.jsx)("div",{className:"h-2 rounded-full bg-primary transition-all",style:{width:"".concat($.total>0?Math.min(100,Math.round($.completed/$.total*100)):0,"%")}})}),$.errors.length>0&&(0,a.jsxs)("div",{className:"max-h-32 overflow-y-auto rounded-md border border-border/50 bg-muted/30 p-3 text-xs",children:[(0,a.jsx)("p",{className:"mb-2 font-semibold text-foreground",children:"Ошибки:"}),(0,a.jsx)("div",{className:"space-y-2",children:$.errors.map(e=>(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"font-medium text-foreground break-words",children:e.title}),(0,a.jsx)("p",{className:"text-muted-foreground break-words",children:e.message})]},"".concat(e.id,"-").concat(e.message)))})]}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>{$&&$.running&&!$.stopRequested&&(B.current=!0,X(e=>e?{...e,stopRequested:!0,message:"Остановка запрошена. Завершаем текущий элемент..."}:e))},disabled:!$.running||$.stopRequested,className:"flex items-center gap-2",children:$.stopRequested?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(N.Z,{className:"h-4 w-4"}),"Остановка..."]}):$.running?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(b.Z,{className:"h-4 w-4"}),"Остановить"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(b.Z,{className:"h-4 w-4"}),"Остановлено"]})}),(0,a.jsx)(l.z,{size:"sm",onClick:()=>{$&&(!$.running||$.stopRequested)&&(X(null),W(new Set))},disabled:$.running,children:"Закрыть"})]})]})})}):U.size>0&&(0,a.jsx)("div",{className:"fixed bottom-8 left-1/2 -translate-x-1/2 z-50 animate-in slide-in-from-bottom-4 fade-in duration-300",children:(0,a.jsx)(r.Zb,{className:"border-primary shadow-2xl",children:(0,a.jsx)(r.aY,{className:"py-4 px-6",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("span",{className:"text-sm font-medium",children:["Выбрано: ",(0,a.jsx)("span",{className:"text-primary font-bold",children:U.size})," материал(ов)"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(l.z,{size:"sm",variant:"default",onClick:()=>eD("published"),children:[(0,a.jsx)(w.Z,{className:"mr-2 h-4 w-4"}),"Опубликовать"]}),(0,a.jsxs)(l.z,{size:"sm",variant:"secondary",onClick:()=>eD("generate-summary"),children:[(0,a.jsx)(C.Z,{className:"mr-2 h-4 w-4"}),"Саммари"]}),(0,a.jsxs)(l.z,{size:"sm",variant:"outline",onClick:()=>eD("archived"),children:[(0,a.jsx)(k.Z,{className:"mr-2 h-4 w-4"}),"Архивировать"]}),(0,a.jsxs)(l.z,{size:"sm",variant:"destructive",onClick:()=>eD("delete"),children:[(0,a.jsx)(S.Z,{className:"mr-2 h-4 w-4"}),"Удалить"]})]}),(0,a.jsx)(l.z,{size:"sm",variant:"ghost",onClick:()=>W(new Set),children:"Отменить"})]})})})}),(0,a.jsxs)(r.Zb,{children:[(0,a.jsx)(r.Ol,{children:(0,a.jsxs)(r.ll,{children:["Материалы (",ei,")"]})}),(0,a.jsxs)(r.aY,{children:[(0,a.jsxs)("div",{className:"mb-4 flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsx)(h.I,{placeholder:"Поиск…",value:ex.search,onChange:e=>eh(s=>({...s,search:e.target.value})),className:"h-9 w-full sm:w-64"}),(0,a.jsx)(D,{label:"Категории",options:ed.categories.map(e=>({value:e.id,label:e.isHidden?"".concat(e.name," (скрыта)"):e.name})),selected:ex.categories,onChange:e=>eh(s=>({...s,categories:e})),disabled:0===ed.categories.length}),(0,a.jsx)(D,{label:"Страны",options:ed.countries.map(e=>({value:e.id,label:e.name})),selected:ex.countries,onChange:e=>eh(s=>({...s,countries:e})),disabled:0===ed.countries.length}),(0,a.jsx)(D,{label:"Города",options:eZ,selected:ex.cities,onChange:e=>eh(s=>({...s,cities:e})),disabled:0===eZ.length}),(0,a.jsx)(D,{label:"Источники",options:eO.map(e=>({value:e,label:e})),selected:ex.feeds,onChange:e=>eh(s=>({...s,feeds:e})),disabled:0===eO.length})]}),(0,a.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:(0,a.jsx)(l.z,{variant:"ghost",size:"sm",onClick:()=>eh(M),disabled:!eT,children:"Сбросить фильтры"})})]}),!t&&e.length>0&&(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4 pb-4 border-b",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Показано ",0===e.length?0:eL+1,"-",eY," из ",ei]})}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"На странице:"}),(0,a.jsx)("div",{className:"flex gap-1",children:[25,50,100,200].map(e=>(0,a.jsx)(l.z,{variant:ea===e?"default":"outline",size:"sm",onClick:()=>eH(e),className:"h-8 w-12",children:e},e))})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>eq(1),disabled:1===es,className:"h-8 w-8 p-0",title:"Первая страница",children:(0,a.jsx)(z.Z,{className:"h-4 w-4"})}),(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>eq(es-1),disabled:1===es,className:"h-8 w-8 p-0",title:"Предыдущая страница",children:(0,a.jsx)(I.Z,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{className:"flex items-center gap-1 px-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:es}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"из"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:el})]}),(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>eq(es+1),disabled:es===el,className:"h-8 w-8 p-0",title:"Следующая страница",children:(0,a.jsx)(A.Z,{className:"h-4 w-4"})}),(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>eq(el),disabled:es===el,className:"h-8 w-8 p-0",title:"Последняя страница",children:(0,a.jsx)(E.Z,{className:"h-4 w-4"})})]})]})]}),t?(0,a.jsx)("div",{className:"space-y-2",children:Array.from({length:10}).map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(x.O,{className:"h-12 w-12"}),(0,a.jsx)(x.O,{className:"h-16 w-16 rounded"}),(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsx)(x.O,{className:"h-4 w-full"}),(0,a.jsx)(x.O,{className:"h-4 w-3/4"})]}),(0,a.jsx)(x.O,{className:"h-8 w-24"}),(0,a.jsx)(x.O,{className:"h-8 w-20"})]},s))}):0===e.length?(0,a.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:eT?"Материалы по выбранным фильтрам не найдены.":"Нет материалов. Добавьте RSS фиды и синхронизируйте их на главной."}):(0,a.jsxs)(i.iA,{children:[(0,a.jsx)(i.xD,{children:(0,a.jsxs)(i.SC,{children:[(0,a.jsx)(i.ss,{className:"w-12",children:(0,a.jsx)(u.X,{checked:e.length>0&&e.every(e=>U.has(e.id)),onCheckedChange:()=>{if(null==$||!$.running){if(U.size===e.length&&e.length>0){let s=new Set(U);e.forEach(e=>s.delete(e.id)),W(s)}else{let s=new Set(U);e.forEach(e=>s.add(e.id)),W(s)}}},disabled:!!(null==$?void 0:$.running)})}),(0,a.jsx)(i.ss,{className:"w-20",children:"Обложка"}),(0,a.jsx)(i.ss,{className:"min-w-[300px]",children:"Заголовок"}),(0,a.jsx)(i.ss,{className:"w-[220px]",children:"Категории"}),(0,a.jsx)(i.ss,{children:"Источник"}),(0,a.jsx)(i.ss,{className:"w-[130px]",children:"Дата"}),(0,a.jsx)(i.ss,{className:"w-[140px]",children:"Статус"})]})}),(0,a.jsx)(i.RM,{children:(null==$?void 0:$.running)?Array.from({length:Math.min(e.length||ea,ea)}).map((e,s)=>(0,a.jsxs)(i.SC,{children:[(0,a.jsx)(i.pj,{children:(0,a.jsx)(x.O,{className:"h-4 w-4 rounded"})}),(0,a.jsx)(i.pj,{children:(0,a.jsx)(x.O,{className:"h-16 w-16 rounded"})}),(0,a.jsxs)(i.pj,{children:[(0,a.jsx)(x.O,{className:"h-4 w-48"}),(0,a.jsx)(x.O,{className:"mt-2 h-4 w-64"})]}),(0,a.jsx)(i.pj,{children:(0,a.jsx)(x.O,{className:"h-4 w-40"})}),(0,a.jsx)(i.pj,{children:(0,a.jsx)(x.O,{className:"h-4 w-28"})}),(0,a.jsx)(i.pj,{children:(0,a.jsx)(x.O,{className:"h-4 w-24"})}),(0,a.jsx)(i.pj,{children:(0,a.jsx)(x.O,{className:"h-4 w-24"})})]},"bulk-skeleton-".concat(s))):e.map(e=>(0,a.jsxs)(i.SC,{className:"cursor-pointer hover:bg-accent/50",children:[(0,a.jsx)(i.pj,{onClick:e=>e.stopPropagation(),children:(0,a.jsx)(u.X,{checked:U.has(e.id),onCheckedChange:()=>eU(e.id),disabled:!!(null==$?void 0:$.running)})}),(0,a.jsx)(i.pj,{onClick:()=>!(null==$?void 0:$.running)&&eJ(e),children:e.thumbnail?(0,a.jsx)("img",{src:e.thumbnail,alt:e.title,className:"w-16 h-16 object-cover rounded",onError:e=>{e.currentTarget.style.display="none"}}):(0,a.jsx)("div",{className:"w-16 h-16 bg-muted rounded flex items-center justify-center text-xs text-muted-foreground",children:"Нет фото"})}),(0,a.jsx)(i.pj,{className:"font-medium",onClick:()=>!(null==$?void 0:$.running)&&eJ(e),children:(0,a.jsx)("div",{className:"line-clamp-3 leading-snug",children:e.title})}),(0,a.jsx)(i.pj,{onClick:()=>!(null==$?void 0:$.running)&&eJ(e),children:e.categories&&e.categories.length>0?(0,a.jsxs)("div",{className:"flex max-w-[220px] flex-wrap gap-1",children:[e.categories.slice(0,3).map(s=>(0,a.jsx)(c.C,{variant:"outline",className:"text-xs font-normal",children:s.name},"".concat(e.id,"-category-").concat(s.id))),e.categories.length>3&&(0,a.jsxs)(c.C,{variant:"secondary",className:"text-xs font-normal",children:["+",e.categories.length-3]})]}):(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"—"})}),(0,a.jsx)(i.pj,{onClick:()=>!(null==$?void 0:$.running)&&eJ(e),children:(0,a.jsx)("div",{className:"truncate max-w-[200px]",title:e.feedName||e.source,children:e.feedName||e.source||"—"})}),(0,a.jsx)(i.pj,{onClick:()=>!(null==$?void 0:$.running)&&eJ(e),children:e0(e.createdAt)}),(0,a.jsx)(i.pj,{onClick:()=>!(null==$?void 0:$.running)&&eJ(e),children:eG(e.status)})]},e.id))})]}),!t&&e.length>0&&(0,a.jsxs)("div",{className:"flex items-center justify-between mt-4 pt-4 border-t",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Показано ",0===e.length?0:eL+1,"-",eY," из ",ei]})}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"На странице:"}),(0,a.jsx)("div",{className:"flex gap-1",children:[25,50,100,200].map(e=>(0,a.jsx)(l.z,{variant:ea===e?"default":"outline",size:"sm",onClick:()=>eH(e),className:"h-8 w-12",children:e},e))})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>eq(1),disabled:1===es,className:"h-8 w-8 p-0",title:"Первая страница",children:(0,a.jsx)(z.Z,{className:"h-4 w-4"})}),(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>eq(es-1),disabled:1===es,className:"h-8 w-8 p-0",title:"Предыдущая страница",children:(0,a.jsx)(I.Z,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{className:"flex items-center gap-1 px-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:es}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"из"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:el})]}),(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>eq(es+1),disabled:es===el,className:"h-8 w-8 p-0",title:"Следующая страница",children:(0,a.jsx)(A.Z,{className:"h-4 w-4"})}),(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>eq(el),disabled:es===el,className:"h-8 w-8 p-0",title:"Последняя страница",children:(0,a.jsx)(E.Z,{className:"h-4 w-4"})})]})]})]})]})]}),(0,a.jsx)(o.aR,{open:null!==Q,onOpenChange:e=>!e&&K(null),children:(0,a.jsxs)(o._T,{children:[(0,a.jsxs)(o.fY,{children:[(0,a.jsx)(o.f$,{children:null==e1?void 0:e1.title}),(0,a.jsx)(o.yT,{children:null==e1?void 0:e1.description})]}),(0,a.jsxs)(o.xo,{children:[(0,a.jsx)(o.le,{children:"Отмена"}),(0,a.jsx)(o.OL,{onClick:eV,disabled:(null==$?void 0:$.running)===!0,className:"".concat((null==e1?void 0:e1.variant)==="destructive"?"bg-destructive text-destructive-foreground hover:bg-destructive/90":""),children:null==e1?void 0:e1.actionText})]})]})}),(0,a.jsx)(d.Vq,{open:L,onOpenChange:Y,children:(0,a.jsxs)(d.cZ,{className:"w-[min(95vw,1100px)] max-h-[85vh] overflow-y-auto",children:[(0,a.jsxs)(d.fK,{children:[(0,a.jsx)(d.$N,{className:"text-2xl pr-8",children:null==F?void 0:F.title}),(0,a.jsxs)(d.Be,{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm",children:[(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"Автор:"})," ",(null==F?void 0:F.author)||"—"]}),(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"Источник:"})," ",(null==F?void 0:F.feedName)||(null==F?void 0:F.source)||"—"]}),(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"Дата:"})," ",F&&e0(F.createdAt)]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsx)(c.C,{variant:(null==F?void 0:F.processed)?"secondary":"outline",className:(null==F?void 0:F.processed)?"border-green-500/20 bg-green-500/10 text-green-700 dark:text-green-400":"text-muted-foreground",children:(null==F?void 0:F.processed)?"Обработан":"Не обработан"}),(0,a.jsx)(c.C,{variant:(null==F?void 0:F.published)?"secondary":"outline",className:(null==F?void 0:F.published)?"border-blue-500/20 bg-blue-500/10 text-blue-700 dark:text-blue-400":"text-muted-foreground",children:(null==F?void 0:F.published)?"Опубликован":"Не опубликован"})]})]})]}),(0,a.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Мета описание"}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:[ez.length,"/160"]})]}),(0,a.jsx)(f.g,{value:ez,onChange:e=>eI(e.target.value),maxLength:160,rows:3,placeholder:"Краткое описание статьи"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Саммари"}),(null==F?void 0:F.summary)&&(0,a.jsx)(c.C,{variant:"secondary",children:"AI"})]}),(0,a.jsx)(f.g,{value:ek,onChange:e=>eS(e.target.value),rows:6,placeholder:"Краткое саммари на 3-5 предложений"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Категории публикации"})}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:ew.categoryIds.length>0?ew.categoryIds.map(e=>ed.categories.find(s=>s.id===e)).filter(e=>!!e).map(e=>(0,a.jsxs)(c.C,{variant:e.isHidden?"outline":"secondary",className:"gap-1",children:[e.name,e.isHidden&&(0,a.jsx)("span",{className:"ml-1 rounded bg-muted px-1 text-[10px] uppercase text-muted-foreground",children:"скрыта"}),(0,a.jsx)(l.z,{type:"button",variant:"ghost",size:"icon",className:"h-4 w-4 text-muted-foreground hover:text-destructive",onClick:()=>eW("categoryIds",e.id),children:(0,a.jsx)(O.Z,{className:"h-3 w-3"})})]},"pub-category-".concat(e.id))):(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"У материала нет выбранных категорий"})})]})]}),(0,a.jsxs)("div",{className:"mt-6 space-y-3",children:[(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>H(e=>!e),className:"w-full sm:w-56",children:q?"Скрыть полный текст":"Показать полный текст"}),q&&(0,a.jsx)("div",{className:"rounded-lg border bg-background p-4 text-sm leading-relaxed",children:(null==F?void 0:F.fullContent)?(0,a.jsx)("div",{className:"prose prose-sm max-w-none dark:prose-invert",dangerouslySetInnerHTML:{__html:F.fullContent.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/on\w+="[^"]*"/g,"").replace(/on\w+='[^']*'/g,"")}}):(0,a.jsx)("p",{className:"text-foreground",children:null==F?void 0:F.content})})]}),(0,a.jsx)("div",{className:"mt-6 space-y-6",children:em?(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Загрузка справочников..."}):(0,a.jsxs)("div",{className:"space-y-5",children:[(0,a.jsxs)("section",{className:"rounded-lg border bg-muted/30 p-4 space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(g._,{className:"text-sm font-semibold",children:"Категории"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Выберите 1–3 наиболее релевантных категории или добавьте новую."})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3",children:[(0,a.jsx)(D,{label:"Добавить из списка",options:ed.categories.map(e=>({value:e.id,label:e.isHidden?"".concat(e.name," (скрыта)"):e.name})),selected:ew.categoryIds,onChange:e=>eC(s=>({...s,categoryIds:e})),disabled:0===ed.categories.length,fullWidth:!0,maxSelected:1}),(0,a.jsx)(l.z,{variant:"ghost",size:"sm",onClick:()=>e$("categoryIds"),disabled:0===ew.categoryIds.length,className:"sm:w-auto w-full",children:"Очистить"})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:ew.categoryIds.length>0?ew.categoryIds.map(e=>{let s=ed.categories.find(s=>s.id===e);return s?(0,a.jsxs)(c.C,{variant:"secondary",className:"gap-1",children:[s.name,(0,a.jsx)("button",{type:"button",className:"ml-1 inline-flex h-4 w-4 items-center justify-center rounded-sm hover:text-destructive",onClick:()=>eW("categoryIds",e),children:(0,a.jsx)(O.Z,{className:"h-3 w-3"})})]},"selected-category-".concat(e)):null}):(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"Категории не выбраны"})}),(0,a.jsxs)("div",{className:"space-y-2 border-t pt-4",children:[(0,a.jsx)(g._,{className:"text-xs font-medium text-muted-foreground",children:"Нет нужной категории?"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row",children:[(0,a.jsx)(h.I,{value:eN.category,onChange:eX("category"),placeholder:"Название новой категории",className:"h-9"}),(0,a.jsx)(l.z,{size:"sm",onClick:()=>eB("category"),disabled:"category"===ev,children:"category"===ev?"Добавление...":"Добавить"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-5",children:[(0,a.jsxs)("section",{className:"rounded-lg border bg-muted/10 p-4 space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(g._,{className:"text-sm font-semibold",children:"Страны"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Укажите страны, к которым относится материал."})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3",children:[(0,a.jsx)(D,{label:"Добавить страну",options:ed.countries.map(e=>({value:e.id,label:e.name})),selected:ew.countryIds,onChange:e=>eC(s=>({...s,countryIds:e})),disabled:0===ed.countries.length,fullWidth:!0}),(0,a.jsx)(l.z,{variant:"ghost",size:"sm",onClick:()=>e$("countryIds"),disabled:0===ew.countryIds.length,className:"sm:w-auto w-full",children:"Очистить"})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:ew.countryIds.length>0?ew.countryIds.map(e=>{let s=ed.countries.find(s=>s.id===e);return s?(0,a.jsxs)(c.C,{variant:"secondary",className:"gap-1",children:[s.name,(0,a.jsx)("button",{type:"button",className:"ml-1 inline-flex h-4 w-4 items-center justify-center rounded-sm hover:text-destructive",onClick:()=>eW("countryIds",e),children:(0,a.jsx)(O.Z,{className:"h-3 w-3"})})]},"selected-country-".concat(e)):null}):(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"Страны не выбраны"})}),(0,a.jsxs)("div",{className:"space-y-2 border-t pt-4",children:[(0,a.jsx)(g._,{className:"text-xs font-medium text-muted-foreground",children:"Добавить новую страну"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row",children:[(0,a.jsx)(h.I,{value:eN.country,onChange:eX("country"),placeholder:"Название новой страны",className:"h-9"}),(0,a.jsx)(l.z,{size:"sm",onClick:()=>eB("country"),disabled:"country"===ev,children:"country"===ev?"Добавление...":"Добавить"})]})]})]}),(0,a.jsxs)("section",{className:"rounded-lg border bg-muted/10 p-4 space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(g._,{className:"text-sm font-semibold",children:"Города"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Выберите города. Сначала укажите страну — мы подберём связанные города автоматически."})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3",children:[(0,a.jsx)(D,{label:"Добавить город",options:eZ,selected:ew.cityIds,onChange:e=>eC(s=>({...s,cityIds:e})),disabled:0===eZ.length,fullWidth:!0}),(0,a.jsx)(l.z,{variant:"ghost",size:"sm",onClick:()=>e$("cityIds"),disabled:0===ew.cityIds.length,className:"sm:w-auto w-full",children:"Очистить"})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:ew.cityIds.length>0?ew.cityIds.map(e=>{let s=eZ.find(s=>s.value===e);return s?(0,a.jsxs)(c.C,{variant:"secondary",className:"gap-1",children:[s.label,(0,a.jsx)("button",{type:"button",className:"ml-1 inline-flex h-4 w-4 items-center justify-center rounded-sm hover:text-destructive",onClick:()=>eW("cityIds",e),children:(0,a.jsx)(O.Z,{className:"h-3 w-3"})})]},"selected-city-".concat(e)):null}):(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"Города не выбраны"})}),(0,a.jsxs)("div",{className:"space-y-2 border-t pt-4",children:[(0,a.jsx)(g._,{className:"text-xs font-medium text-muted-foreground",children:"Добавить новый город"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row",children:[(0,a.jsx)(h.I,{value:eN.city,onChange:eX("city"),placeholder:"Название нового города",className:"h-9",disabled:0===ew.countryIds.length}),(0,a.jsx)(l.z,{size:"sm",onClick:()=>eB("city"),disabled:0===ew.countryIds.length||"city"===ev,children:"city"===ev?"Добавление...":"Добавить"})]}),0===ew.countryIds.length&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Чтобы добавить город, сначала выберите страну."})]})]})]})]})}),(0,a.jsxs)("div",{className:"mt-6 flex flex-col items-end gap-2",children:[(0,a.jsx)(l.z,{onClick:eK,disabled:ep||em,variant:"outline",className:"w-full sm:w-56",children:ep?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Регенерация..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C.Z,{className:"mr-2 h-4 w-4"}),"Регенерировать таксономию"]})}),(0,a.jsx)(l.z,{onClick:eQ,disabled:eA||ef||em,className:"w-full sm:w-56",children:eA||ef?"Сохранение...":"Сохранить"})]}),((null==F?void 0:F.link)||(null==F?void 0:F.source))&&(0,a.jsx)("div",{className:"mt-6 pt-4 border-t",children:(0,a.jsx)(l.z,{variant:"outline",size:"sm",asChild:!0,children:(0,a.jsxs)("a",{href:F.link||F.source||"#",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2",children:[(0,a.jsx)(Z.Z,{className:"h-4 w-4"}),"Открыть источник"]})})})]})})]})})]})}},4693:function(e,s,t){"use strict";t.d(s,{C:function(){return i}});var a=t(7437);t(2265);var n=t(3027),l=t(7440);let r=(0,n.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:s,variant:t,...n}=e;return(0,a.jsx)("div",{className:(0,l.cn)(r({variant:t}),s),...n})}},6910:function(e,s,t){"use strict";t.d(s,{$F:function(){return o},AW:function(){return m},Ju:function(){return h},VD:function(){return f},Xi:function(){return u},bO:function(){return x},h_:function(){return d}});var a=t(7437),n=t(2265),l=t(8402),r=t(9346),i=t(4374),c=t(7440);let d=l.fC,o=l.xz;l.ZA,l.Uv,l.Tr,l.Ee,n.forwardRef((e,s)=>{let{className:t,inset:n,children:i,...d}=e;return(0,a.jsxs)(l.fF,{ref:s,className:(0,c.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",n&&"pl-8",t),...d,children:[i,(0,a.jsx)(r.Z,{className:"ml-auto h-4 w-4"})]})}).displayName=l.fF.displayName,n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(l.tu,{ref:s,className:(0,c.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n})}).displayName=l.tu.displayName;let m=n.forwardRef((e,s)=>{let{className:t,sideOffset:n=4,...r}=e;return(0,a.jsx)(l.Uv,{children:(0,a.jsx)(l.VY,{ref:s,sideOffset:n,className:(0,c.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r})})});m.displayName=l.VY.displayName;let u=n.forwardRef((e,s)=>{let{className:t,inset:n,...r}=e;return(0,a.jsx)(l.ck,{ref:s,className:(0,c.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n&&"pl-8",t),...r})});u.displayName=l.ck.displayName;let x=n.forwardRef((e,s)=>{let{className:t,children:n,checked:r,...d}=e;return(0,a.jsxs)(l.oC,{ref:s,className:(0,c.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:r,...d,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(l.wU,{children:(0,a.jsx)(i.Z,{className:"h-4 w-4"})})}),n]})});x.displayName=l.oC.displayName,n.forwardRef((e,s)=>{let{className:t,children:n,...r}=e;return(0,a.jsxs)(l.Rk,{ref:s,className:(0,c.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...r,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(l.wU,{children:(0,a.jsx)("span",{className:"h-2 w-2 rounded-full bg-current"})})}),n]})}).displayName=l.Rk.displayName;let h=n.forwardRef((e,s)=>{let{className:t,inset:n,...r}=e;return(0,a.jsx)(l.__,{ref:s,className:(0,c.cn)("px-2 py-1.5 text-sm font-semibold",n&&"pl-8",t),...r})});h.displayName=l.__.displayName;let f=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(l.Z0,{ref:s,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",t),...n})});f.displayName=l.Z0.displayName},5273:function(e,s,t){"use strict";t.d(s,{SP:function(){return d},dr:function(){return c},mQ:function(){return i},nU:function(){return o}});var a=t(7437),n=t(2265),l=t(2447),r=t(7440);let i=l.fC,c=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(l.aV,{ref:s,className:(0,r.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...n})});c.displayName=l.aV.displayName;let d=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(l.xz,{ref:s,className:(0,r.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...n})});d.displayName=l.xz.displayName;let o=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(l.VY,{ref:s,className:(0,r.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...n})});o.displayName=l.VY.displayName},3146:function(e,s,t){"use strict";t.d(s,{g:function(){return r}});var a=t(7437),n=t(2265),l=t(7440);let r=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...n})});r.displayName="Textarea"}},function(e){e.O(0,[876,776,138,650,413,398,402,395,320,369,971,23,744],function(){return e(e.s=1377)}),_N_E=e.O()}]);