(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[227],{1377:function(e,s,t){Promise.resolve().then(t.bind(t,1470))},1470:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return T}});var a=t(7437),r=t(2265),l=t(495),n=t(6013),i=t(6975),c=t(4693),d=t(837),o=t(6780),m=t(5273),u=t(6466),h=t(2738),x=t(3102),p=t(7135),g=t(4602),f=t(2083),j=t(4166),v=t(2675),y=t(3925),N=t(7785),w=t(1172),b=t(9346),C=t(664),S=t(1154),k=t(870),z=t(2790),I=t(6219),A=t(7776),E=t(6910);let Z={search:"",categories:[],countries:[],cities:[],feeds:[],onlyWithSummary:!1};function O(e){let{label:s,options:t,selected:n,onChange:i,disabled:d}=e,[o,m]=(0,r.useState)(""),u=e=>{n.includes(e)?i(n.filter(s=>s!==e)):i([...n,e])},h=(0,r.useMemo)(()=>{let e=o.trim().toLowerCase();return e?t.filter(s=>s.label.toLowerCase().includes(e)):t},[t,o]);return(0,a.jsxs)(E.h_,{onOpenChange:e=>!e&&m(""),children:[(0,a.jsx)(E.$F,{asChild:!0,disabled:d,children:(0,a.jsxs)(l.z,{variant:"outline",size:"sm",className:"min-w-[160px] justify-between",children:[(0,a.jsx)("span",{children:s}),(0,a.jsxs)("span",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[n.length>0&&(0,a.jsx)(c.C,{variant:"secondary",className:"px-1 text-xs font-medium",children:n.length}),(0,a.jsx)(g.Z,{className:"h-3 w-3"})]})]})}),(0,a.jsxs)(E.AW,{align:"start",className:"w-64 max-h-64 overflow-y-auto",children:[(0,a.jsx)(E.Ju,{children:s}),(0,a.jsx)(E.VD,{}),(0,a.jsx)("div",{className:"p-1",children:(0,a.jsx)(x.I,{placeholder:"Поиск...",value:o,onChange:e=>m(e.target.value),className:"h-8"})}),(0,a.jsx)(E.VD,{}),0===h.length?(0,a.jsx)("div",{className:"px-2 py-1.5 text-xs text-muted-foreground",children:"Ничего не найдено"}):h.map(e=>(0,a.jsx)(E.bO,{checked:n.includes(e.value),onCheckedChange:()=>u(e.value),children:e.label},String(e.value)))]})]})}function T(){let[e,s]=(0,r.useState)([]),[t,g]=(0,r.useState)(!0),[E,T]=(0,r.useState)("all"),[P,_]=(0,r.useState)(null),[M,R]=(0,r.useState)(!1),[D,F]=(0,r.useState)(new Set),[L,V]=(0,r.useState)(null),[J,W]=(0,r.useState)(!1),[Y,$]=(0,r.useState)(new Set),[H,U]=(0,r.useState)(new Set),[X,B]=(0,r.useState)({total:0,new:0,processed:0,published:0,archived:0}),[q,K]=(0,r.useState)(1),[Q,G]=(0,r.useState)(50),[ee,es]=(0,r.useState)(1),[et,ea]=(0,r.useState)(0),[er,el]=(0,r.useState)(new Set),[en,ei]=(0,r.useState)({categories:[],countries:[]}),[ec,ed]=(0,r.useState)(!1),[eo,em]=(0,r.useState)(Z),[eu,eh]=(0,r.useState)(!1),[ex,ep]=(0,r.useState)(!1),[eg,ef]=(0,r.useState)(null),[ej,ev]=(0,r.useState)({category:"",country:"",city:""}),[ey,eN]=(0,r.useState)({categoryIds:[],countryIds:[],cityIds:[]}),ew=(0,r.useMemo)(()=>{let s=new Set;return e.forEach(e=>{let t=e.feedName||e.source;t&&s.add(t)}),Array.from(s).sort((e,s)=>e.localeCompare(s,"ru"))},[e]),eb=(0,r.useMemo)(()=>{let e=[];return en.countries.forEach(s=>{s.cities.forEach(t=>{e.push({value:t.id,label:"".concat(t.name," — ").concat(s.name)})})}),e.sort((e,s)=>e.label.localeCompare(s.label,"ru"))},[en.countries]),eC=(0,r.useMemo)(()=>eo.search.trim().length>0||eo.categories.length>0||eo.countries.length>0||eo.cities.length>0||eo.feeds.length>0||eo.onlyWithSummary,[eo]),eS=(0,r.useCallback)(async function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=null!==(e=r.silent)&&void 0!==e&&e;l||g(!0);try{let e=new URLSearchParams;e.set("status",t),e.set("page",a.toString()),e.set("pageSize",Q.toString()),eo.search&&e.set("search",eo.search),eo.categories.length>0&&e.set("categoryIds",eo.categories.join(",")),eo.countries.length>0&&e.set("countryIds",eo.countries.join(",")),eo.cities.length>0&&e.set("cityIds",eo.cities.join(",")),eo.feeds.length>0&&e.set("feedNames",eo.feeds.join(",")),eo.onlyWithSummary&&e.set("onlyWithSummary","true");let r=await fetch("/api/materials?".concat(e.toString())),l=await r.json();l.success&&(s(l.data),l.pagination&&(es(l.pagination.totalPages),ea(l.pagination.total),K(l.pagination.page)),B(l.stats||{total:0,new:0,processed:0,published:0,archived:0}))}catch(e){console.error("Error fetching materials:",e)}finally{l||g(!1)}},[eo,Q,q]),ek=(0,r.useCallback)(async(e,s)=>{let t=await fetch("/api/materials",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,...s})}),a=await t.json();if(!t.ok||!a.success)throw Error(a.error||"Не удалось обновить материал")},[]),ez=(e,s,t)=>"archived"===t?"archived":s?"published":e?"processed":"new",eI=async(e,s)=>{$(s=>{let t=new Set(s);return t.add(e.id),t});let t=ez(s,e.published,e.status),a={processed:s};e.status!==t&&(a.status=t);try{await ek(e.id,a),A.Am.success(s?"Материал отмечен как обработанный":"Материал отмечен как необработанный"),_(t=>{var r;return t&&t.id===e.id?{...t,processed:s,status:null!==(r=a.status)&&void 0!==r?r:t.status}:t}),await eS(E,q,{silent:!0})}catch(e){console.error("Error updating processed status:",e),A.Am.error("Не удалось обновить статус обработки")}finally{$(s=>{let t=new Set(s);return t.delete(e.id),t})}},eA=async(e,s)=>{U(s=>{let t=new Set(s);return t.add(e.id),t});let t=ez(e.processed,s,e.status),a={published:s};e.status!==t&&(a.status=t);try{await ek(e.id,a),A.Am.success(s?"Материал опубликован":"Публикация снята"),_(t=>{var r;return t&&t.id===e.id?{...t,published:s,status:null!==(r=a.status)&&void 0!==r?r:t.status}:t}),await eS(E,q,{silent:!0})}catch(e){console.error("Error updating publication status:",e),A.Am.error("Не удалось обновить статус публикации")}finally{U(s=>{let t=new Set(s);return t.delete(e.id),t})}};(0,r.useEffect)(()=>{K(1),F(new Set)},[eo,E]),(0,r.useEffect)(()=>{eS(E,q)},[eS,E,q]),(0,r.useEffect)(()=>{let e=new EventSource("/api/materials/stream?status=".concat(E));return e.onmessage=e=>{try{let r=JSON.parse(e.data);if("new-material"===r.type){let e=r.data,l=!0;if(eo.categories.length>0){var t,a;let s=null!==(a=null===(t=e.categories)||void 0===t?void 0:t.map(e=>e.id))&&void 0!==a?a:[];eo.categories.some(e=>s.includes(e))||(l=!1)}if(l&&eo.countries.length>0){let s=Array.isArray(e.countries)?e.countries.map(e=>e.id):[];eo.countries.some(e=>s.includes(e))||(l=!1)}if(l&&eo.cities.length>0){let s=Array.isArray(e.cities)?e.cities.map(e=>e.id):[];eo.cities.some(e=>s.includes(e))||(l=!1)}if(l&&eo.feeds.length>0){let s=e.feedName||e.source||"";eo.feeds.includes(s)||(l=!1)}if(l&&eo.onlyWithSummary&&(!e.summary||0===e.summary.trim().length)&&(l=!1),l&&eo.search.trim()){let s=eo.search.trim().toLowerCase();[e.title,e.summary,e.content,e.feedName,e.source].filter(Boolean).join(" ").toLowerCase().includes(s)||(l=!1)}l&&"all"!==E&&(("processed"!==E||e.processed)&&("published"!==E||e.published)?"archived"===E&&"archived"!==e.status?l=!1:"new"===E&&(e.processed||"archived"===e.status)?l=!1:["processed","published","archived","new"].includes(E)||e.status===E||(l=!1):l=!1),l&&(1===q?(s(s=>[e,...s].slice(0,Q)),ea(e=>e+1)):eS(E,q))}else"sync-complete"===r.type&&eS(E,q)}catch(e){console.error("Error parsing SSE message:",e)}},e.onerror=s=>{console.error("SSE connection error:",s),setTimeout(()=>{e.close()},5e3)},()=>{e.close()}},[E,eo,q,Q,eS]);let eE=async()=>{try{ed(!0);let t=await fetch("/api/taxonomy"),a=await t.json();if(a.success){var e,s;ei({categories:null!==(e=a.categories)&&void 0!==e?e:[],countries:null!==(s=a.countries)&&void 0!==s?s:[]})}else A.Am.error(a.error||"Не удалось загрузить таксономию")}catch(e){console.error("Error fetching taxonomy:",e),A.Am.error("Не удалось загрузить таксономию")}finally{ed(!1)}},eZ=e=>{if(0===D.size){A.Am.warning("Выберите материалы для обработки");return}V(e)},eO=async()=>{if(!L)return;let s=Array.from(D);W(!0);try{if("generate-summary"===L){let e=0,t=0,a="";for(let r of s){el(e=>new Set(e).add(r));try{let s=await fetch("/api/materials/generate-summary",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({materialId:r})}),l=await s.json();l.success?e++:(t++,a||(a=l.error),console.error("Failed to generate summary for ".concat(r,":"),l.error))}catch(e){t++,a||(a=e instanceof Error?e.message:"Неизвестная ошибка"),console.error("Error generating summary for ".concat(r,":"),e)}finally{el(e=>{let s=new Set(e);return s.delete(r),s})}}await eS(E),await eE(),F(new Set),0===t?A.Am.success("Саммари успешно сгенерировано для ".concat(e," материал(ов)")):0===e?A.Am.error("Ошибка: ".concat(a)):A.Am.warning("Успешно: ".concat(e,", Ошибки: ").concat(t,". ").concat(a))}else{if("delete"===L)for(let e of s)await fetch("/api/materials?id=".concat(e),{method:"DELETE"});else if("published"===L){let r=new Map(e.map(e=>[e.id,e]));for(let e of s){var t,a;let s=r.get(e),l=ez(null!==(t=null==s?void 0:s.processed)&&void 0!==t&&t,!0,null!==(a=null==s?void 0:s.status)&&void 0!==a?a:"new");await ek(e,{published:!0,status:l})}}else if("archived"===L)for(let e of s)await ek(e,{status:"archived",published:!1});await eS(E,q),F(new Set),A.Am.success("Успешно ".concat({published:"опубликовано",archived:"архивировано",delete:"удалено"}[L]," ").concat(s.length," материал(ов)"))}}catch(e){console.error("Error performing bulk action:",e),A.Am.error("Ошибка при выполнении действия")}finally{W(!1),V(null)}},eT=async e=>{T(e),em(Z),await eS(e),F(new Set),K(1)},eP=e=>{var s,t,a,r,l,n;_(e),eN({categoryIds:null!==(r=null===(s=e.categories)||void 0===s?void 0:s.map(e=>e.id))&&void 0!==r?r:[],countryIds:null!==(l=null===(t=e.countries)||void 0===t?void 0:t.map(e=>e.id))&&void 0!==l?l:[],cityIds:null!==(n=null===(a=e.cities)||void 0===a?void 0:a.map(e=>e.id))&&void 0!==n?n:[]}),R(!0)},e_=(q-1)*Q,eM=e_+e.length,eR=e=>{K(Math.max(1,Math.min(e,ee)))},eD=e=>{G(e),K(1)},eF=e=>{let s=new Set(D);s.has(e)?s.delete(e):s.add(e),F(s)},eL=(e,s)=>{eN(t=>{let a=new Set(t[e]);return a.delete(s),{...t,[e]:Array.from(a)}})},eV=e=>s=>{ev(t=>({...t,[e]:s.target.value}))},eJ=async e=>{let s=ej[e];if(!s.trim()){A.Am.warning("Введите название");return}if("city"===e){if(0===ey.countryIds.length){A.Am.warning("Выберите хотя бы одну страну перед добавлением города");return}let t=ey.countryIds[0];try{ef(e);let a=await fetch("/api/taxonomy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:e,name:s,countryId:t})}),r=await a.json();if(!r.success){A.Am.error(r.error||"Не удалось создать элемент");return}await eE(),eN(e=>({...e,cityIds:Array.from(new Set([...e.cityIds,r.data.id]))})),ev(s=>({...s,[e]:""})),A.Am.success("Элемент создан")}catch(e){console.error("Error creating taxonomy item:",e),A.Am.error("Ошибка при создании элемента")}finally{ef(null)}return}try{ef(e);let t=await fetch("/api/taxonomy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:e,name:s})}),a=await t.json();if(!a.success){A.Am.error(a.error||"Не удалось создать элемент");return}switch(await eE(),e){case"category":eN(e=>({...e,categoryIds:Array.from(new Set([...e.categoryIds,a.data.id]))}));break;case"country":eN(e=>({...e,countryIds:Array.from(new Set([...e.countryIds,a.data.id]))}))}ev(s=>({...s,[e]:""})),A.Am.success("Элемент создан")}catch(e){console.error("Error creating taxonomy item:",e),A.Am.error("Ошибка при создании элемента")}finally{ef(null)}},eW=async()=>{if(P)try{var e,t,a,r,l,n,i;ep(!0);let c=await fetch("/api/materials/regenerate-taxonomy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({materialId:P.id})}),d=await c.json();if(!c.ok)throw Error(d.error||"Ошибка при регенерации таксономии");if(d.success&&(null===(e=d.data)||void 0===e?void 0:e.material)){let e=d.data.material;_(e),eN({categoryIds:null!==(l=null===(t=e.categories)||void 0===t?void 0:t.map(e=>e.id))&&void 0!==l?l:[],countryIds:null!==(n=null===(a=e.countries)||void 0===a?void 0:a.map(e=>e.id))&&void 0!==n?n:[],cityIds:null!==(i=null===(r=e.cities)||void 0===r?void 0:r.map(e=>e.id))&&void 0!==i?i:[]}),s(s=>s.map(s=>s.id===e.id?e:s)),A.Am.success("Таксономия успешно обновлена"),await eE()}}catch(e){console.error("Error regenerating taxonomy:",e),A.Am.error(e.message||"Ошибка при регенерации таксономии")}finally{ep(!1)}},eY=async()=>{if(P)try{var e,t,a,r,l,n;eh(!0);let i=await fetch("/api/materials/taxonomy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({materialId:P.id,categoryIds:ey.categoryIds,countryIds:ey.countryIds,cityIds:ey.cityIds})}),c=await i.json();if(!c.success){A.Am.error(c.error||"Не удалось сохранить таксономию");return}let d=c.data;s(e=>e.map(e=>e.id===d.id?d:e)),_(d),eN({categoryIds:null!==(r=null===(e=d.categories)||void 0===e?void 0:e.map(e=>e.id))&&void 0!==r?r:[],countryIds:null!==(l=null===(t=d.countries)||void 0===t?void 0:t.map(e=>e.id))&&void 0!==l?l:[],cityIds:null!==(n=null===(a=d.cities)||void 0===a?void 0:a.map(e=>e.id))&&void 0!==n?n:[]}),A.Am.success("Таксономия обновлена")}catch(e){console.error("Error saving taxonomy:",e),A.Am.error("Не удалось сохранить таксономию")}finally{eh(!1)}},e$=e=>{switch(e){case"new":return(0,a.jsx)(c.C,{variant:"default",children:"Новый"});case"processed":return(0,a.jsx)(c.C,{variant:"secondary",className:"bg-green-500/10 text-green-700 dark:text-green-400",children:"Обработанные"});case"published":return(0,a.jsx)(c.C,{variant:"secondary",className:"bg-blue-500/10 text-blue-700 dark:text-blue-400",children:"Опубликован"});case"archived":return(0,a.jsx)(c.C,{variant:"outline",children:"Архив"});default:return(0,a.jsx)(c.C,{children:e})}},eH=e=>{let s=new Date(e),t=String(s.getDate()).padStart(2,"0"),a=String(s.getMonth()+1).padStart(2,"0"),r=String(s.getFullYear()).slice(-2),l=String(s.getHours()).padStart(2,"0"),n=String(s.getMinutes()).padStart(2,"0");return"".concat(t,".").concat(a,".").concat(r," ").concat(l,":").concat(n)},eU=(()=>{let e=D.size;switch(L){case"published":return{title:"Опубликовать материалы",description:"Вы уверены, что хотите опубликовать ".concat(e," материал(ов)?"),actionText:"Опубликовать",variant:"default"};case"archived":return{title:"Архивировать материалы",description:"Вы уверены, что хотите архивировать ".concat(e," материал(ов)?"),actionText:"Архивировать",variant:"default"};case"delete":return{title:"Удалить материалы",description:"Вы уверены, что хотите удалить ".concat(e," материал(ов)? Это действие необратимо!"),actionText:"Удалить",variant:"destructive"};case"generate-summary":return{title:"Генерация саммари",description:1===e?"Сгенерировать саммари для этого материала?":"Сгенерировать саммари для ".concat(e," материалов?"),actionText:"Сгенерировать",variant:"default"};default:return null}})();return(0,r.useEffect)(()=>{(async()=>{await eS("all"),await eE()})()},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(I.P,{}),(0,a.jsx)("div",{className:"min-h-screen bg-background p-8",children:(0,a.jsxs)("div",{className:"container space-y-6",children:[(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsx)(m.mQ,{value:E,onValueChange:eT,children:(0,a.jsxs)(m.dr,{children:[(0,a.jsxs)(m.SP,{value:"all",children:["Все ",X.total>0&&(0,a.jsxs)("span",{className:"ml-1.5 text-xs",children:["(",X.total,")"]})]}),(0,a.jsxs)(m.SP,{value:"new",children:["Новые ",X.new>0&&(0,a.jsxs)("span",{className:"ml-1.5 text-xs",children:["(",X.new,")"]})]}),(0,a.jsxs)(m.SP,{value:"processed",children:["Обработанные ",X.processed>0&&(0,a.jsxs)("span",{className:"ml-1.5 text-xs",children:["(",X.processed,")"]})]}),(0,a.jsxs)(m.SP,{value:"published",children:["Опубликованные ",X.published>0&&(0,a.jsxs)("span",{className:"ml-1.5 text-xs",children:["(",X.published,")"]})]}),(0,a.jsxs)(m.SP,{value:"archived",children:["Архив ",X.archived>0&&(0,a.jsxs)("span",{className:"ml-1.5 text-xs",children:["(",X.archived,")"]})]})]})})}),D.size>0&&(0,a.jsx)("div",{className:"fixed bottom-8 left-1/2 -translate-x-1/2 z-50 animate-in slide-in-from-bottom-4 fade-in duration-300",children:(0,a.jsx)(n.Zb,{className:"border-primary shadow-2xl",children:(0,a.jsx)(n.aY,{className:"py-4 px-6",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("span",{className:"text-sm font-medium",children:["Выбрано: ",(0,a.jsx)("span",{className:"text-primary font-bold",children:D.size})," материал(ов)"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(l.z,{size:"sm",variant:"default",onClick:()=>eZ("published"),children:[(0,a.jsx)(f.Z,{className:"mr-2 h-4 w-4"}),"Опубликовать"]}),(0,a.jsxs)(l.z,{size:"sm",variant:"secondary",onClick:()=>eZ("generate-summary"),children:[(0,a.jsx)(j.Z,{className:"mr-2 h-4 w-4"}),"Саммари"]}),(0,a.jsxs)(l.z,{size:"sm",variant:"outline",onClick:()=>eZ("archived"),children:[(0,a.jsx)(v.Z,{className:"mr-2 h-4 w-4"}),"Архивировать"]}),(0,a.jsxs)(l.z,{size:"sm",variant:"destructive",onClick:()=>eZ("delete"),children:[(0,a.jsx)(y.Z,{className:"mr-2 h-4 w-4"}),"Удалить"]})]}),(0,a.jsx)(l.z,{size:"sm",variant:"ghost",onClick:()=>F(new Set),children:"Отменить"})]})})})}),(0,a.jsxs)(n.Zb,{children:[(0,a.jsx)(n.Ol,{children:(0,a.jsxs)(n.ll,{children:["Материалы (",et,")"]})}),(0,a.jsxs)(n.aY,{children:[(0,a.jsxs)("div",{className:"mb-4 flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsx)(x.I,{placeholder:"Поиск…",value:eo.search,onChange:e=>em(s=>({...s,search:e.target.value})),className:"h-9 w-full sm:w-64"}),(0,a.jsx)(O,{label:"Категории",options:en.categories.map(e=>({value:e.id,label:e.name})),selected:eo.categories,onChange:e=>em(s=>({...s,categories:e})),disabled:0===en.categories.length}),(0,a.jsx)(O,{label:"Страны",options:en.countries.map(e=>({value:e.id,label:e.name})),selected:eo.countries,onChange:e=>em(s=>({...s,countries:e})),disabled:0===en.countries.length}),(0,a.jsx)(O,{label:"Города",options:eb,selected:eo.cities,onChange:e=>em(s=>({...s,cities:e})),disabled:0===eb.length}),(0,a.jsx)(O,{label:"Источники",options:ew.map(e=>({value:e,label:e})),selected:eo.feeds,onChange:e=>em(s=>({...s,feeds:e})),disabled:0===ew.length})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsx)(u.X,{checked:eo.onlyWithSummary,onCheckedChange:e=>em(s=>({...s,onlyWithSummary:!0===e}))}),"Только с саммари"]}),(0,a.jsx)(l.z,{variant:"ghost",size:"sm",onClick:()=>em(Z),disabled:!eC,children:"Сбросить фильтры"})]})]}),!t&&e.length>0&&(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4 pb-4 border-b",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Показано ",0===e.length?0:e_+1,"-",eM," из ",et]})}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"На странице:"}),(0,a.jsx)("div",{className:"flex gap-1",children:[25,50,100,200].map(e=>(0,a.jsx)(l.z,{variant:Q===e?"default":"outline",size:"sm",onClick:()=>eD(e),className:"h-8 w-12",children:e},e))})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>eR(1),disabled:1===q,className:"h-8 w-8 p-0",title:"Первая страница",children:(0,a.jsx)(N.Z,{className:"h-4 w-4"})}),(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>eR(q-1),disabled:1===q,className:"h-8 w-8 p-0",title:"Предыдущая страница",children:(0,a.jsx)(w.Z,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{className:"flex items-center gap-1 px-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:q}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"из"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:ee})]}),(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>eR(q+1),disabled:q===ee,className:"h-8 w-8 p-0",title:"Следующая страница",children:(0,a.jsx)(b.Z,{className:"h-4 w-4"})}),(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>eR(ee),disabled:q===ee,className:"h-8 w-8 p-0",title:"Последняя страница",children:(0,a.jsx)(C.Z,{className:"h-4 w-4"})})]})]})]}),t?(0,a.jsx)("div",{className:"space-y-2",children:Array.from({length:10}).map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(h.O,{className:"h-12 w-12"}),(0,a.jsx)(h.O,{className:"h-16 w-16 rounded"}),(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsx)(h.O,{className:"h-4 w-full"}),(0,a.jsx)(h.O,{className:"h-4 w-3/4"})]}),(0,a.jsx)(h.O,{className:"h-8 w-24"}),(0,a.jsx)(h.O,{className:"h-8 w-20"})]},s))}):0===e.length?(0,a.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:eC?"Материалы по выбранным фильтрам не найдены.":"Нет материалов. Добавьте RSS фиды и синхронизируйте их на главной."}):(0,a.jsxs)(i.iA,{children:[(0,a.jsx)(i.xD,{children:(0,a.jsxs)(i.SC,{children:[(0,a.jsx)(i.ss,{className:"w-12",children:(0,a.jsx)(u.X,{checked:e.length>0&&e.every(e=>D.has(e.id)),onCheckedChange:()=>{if(D.size===e.length&&e.length>0){let s=new Set(D);e.forEach(e=>s.delete(e.id)),F(s)}else{let s=new Set(D);e.forEach(e=>s.add(e.id)),F(s)}}})}),(0,a.jsx)(i.ss,{className:"w-20",children:"Обложка"}),(0,a.jsx)(i.ss,{className:"min-w-[300px]",children:"Заголовок"}),(0,a.jsx)(i.ss,{className:"w-[220px]",children:"Категории"}),(0,a.jsx)(i.ss,{children:"Источник"}),(0,a.jsx)(i.ss,{className:"w-[130px]",children:"Дата"}),(0,a.jsx)(i.ss,{className:"w-[140px]",children:"Саммари"}),(0,a.jsx)(i.ss,{className:"w-[160px]",children:"Статус обработки"}),(0,a.jsx)(i.ss,{className:"w-[160px]",children:"Статус публикации"}),(0,a.jsx)(i.ss,{children:"Статус"})]})}),(0,a.jsx)(i.RM,{children:e.map(e=>(0,a.jsxs)(i.SC,{className:"cursor-pointer hover:bg-accent/50",children:[(0,a.jsx)(i.pj,{onClick:e=>e.stopPropagation(),children:(0,a.jsx)(u.X,{checked:D.has(e.id),onCheckedChange:()=>eF(e.id)})}),(0,a.jsx)(i.pj,{onClick:()=>eP(e),children:e.thumbnail?(0,a.jsx)("img",{src:e.thumbnail,alt:e.title,className:"w-16 h-16 object-cover rounded",onError:e=>{e.currentTarget.style.display="none"}}):(0,a.jsx)("div",{className:"w-16 h-16 bg-muted rounded flex items-center justify-center text-xs text-muted-foreground",children:"Нет фото"})}),(0,a.jsx)(i.pj,{className:"font-medium",onClick:()=>eP(e),children:(0,a.jsx)("div",{className:"line-clamp-3 leading-snug",children:e.title})}),(0,a.jsx)(i.pj,{onClick:()=>eP(e),children:e.categories&&e.categories.length>0?(0,a.jsxs)("div",{className:"flex max-w-[220px] flex-wrap gap-1",children:[e.categories.slice(0,3).map(s=>(0,a.jsx)(c.C,{variant:"outline",className:"text-xs font-normal",children:s.name},"".concat(e.id,"-category-").concat(s.id))),e.categories.length>3&&(0,a.jsxs)(c.C,{variant:"secondary",className:"text-xs font-normal",children:["+",e.categories.length-3]})]}):(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"—"})}),(0,a.jsx)(i.pj,{onClick:()=>eP(e),children:(0,a.jsx)("div",{className:"truncate max-w-[200px]",title:e.feedName||e.source,children:e.feedName||e.source||"—"})}),(0,a.jsx)(i.pj,{onClick:()=>eP(e),children:eH(e.createdAt)}),(0,a.jsx)(i.pj,{onClick:()=>eP(e),children:er.has(e.id)?(0,a.jsx)(c.C,{variant:"secondary",className:"bg-blue-500/10 text-blue-700 dark:text-blue-400",children:"Генерация..."}):e.summary&&e.summary.trim().length>0?(0,a.jsx)(c.C,{variant:"default",children:"Есть"}):(0,a.jsx)(c.C,{variant:"outline",children:"Нет"})}),(0,a.jsx)(i.pj,{onClick:e=>e.stopPropagation(),children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(c.C,{variant:e.processed?"secondary":"outline",className:e.processed?"border-green-500/20 bg-green-500/10 text-green-700 dark:text-green-400":"text-muted-foreground",children:e.processed?"Обработан":"Не обработан"}),(0,a.jsx)(l.z,{variant:"ghost",size:"icon",onClick:()=>eI(e,!e.processed),disabled:Y.has(e.id)||J,title:e.processed?"Отметить как необработанный":"Отметить как обработанный",children:Y.has(e.id)?(0,a.jsx)(S.Z,{className:"h-4 w-4 animate-spin"}):e.processed?(0,a.jsx)(k.Z,{className:"h-4 w-4 text-red-500"}):(0,a.jsx)(f.Z,{className:"h-4 w-4 text-green-500"})})]})}),(0,a.jsx)(i.pj,{onClick:e=>e.stopPropagation(),children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(c.C,{variant:e.published?"secondary":"outline",className:e.published?"border-blue-500/20 bg-blue-500/10 text-blue-700 dark:text-blue-400":"text-muted-foreground",children:e.published?"Опубликован":"Не опубликован"}),(0,a.jsx)(l.z,{variant:"ghost",size:"icon",onClick:()=>eA(e,!e.published),disabled:H.has(e.id)||J,title:e.published?"Снять публикацию":"Опубликовать материал",children:H.has(e.id)?(0,a.jsx)(S.Z,{className:"h-4 w-4 animate-spin"}):e.published?(0,a.jsx)(k.Z,{className:"h-4 w-4 text-red-500"}):(0,a.jsx)(f.Z,{className:"h-4 w-4 text-blue-500"})})]})}),(0,a.jsx)(i.pj,{onClick:()=>eP(e),children:e$(e.status)})]},e.id))})]}),!t&&e.length>0&&(0,a.jsxs)("div",{className:"flex items-center justify-between mt-4 pt-4 border-t",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Показано ",0===e.length?0:e_+1,"-",eM," из ",et]})}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"На странице:"}),(0,a.jsx)("div",{className:"flex gap-1",children:[25,50,100,200].map(e=>(0,a.jsx)(l.z,{variant:Q===e?"default":"outline",size:"sm",onClick:()=>eD(e),className:"h-8 w-12",children:e},e))})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>eR(1),disabled:1===q,className:"h-8 w-8 p-0",title:"Первая страница",children:(0,a.jsx)(N.Z,{className:"h-4 w-4"})}),(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>eR(q-1),disabled:1===q,className:"h-8 w-8 p-0",title:"Предыдущая страница",children:(0,a.jsx)(w.Z,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{className:"flex items-center gap-1 px-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:q}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"из"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:ee})]}),(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>eR(q+1),disabled:q===ee,className:"h-8 w-8 p-0",title:"Следующая страница",children:(0,a.jsx)(b.Z,{className:"h-4 w-4"})}),(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>eR(ee),disabled:q===ee,className:"h-8 w-8 p-0",title:"Последняя страница",children:(0,a.jsx)(C.Z,{className:"h-4 w-4"})})]})]})]})]})]}),(0,a.jsx)(o.aR,{open:null!==L,onOpenChange:e=>!e&&V(null),children:(0,a.jsxs)(o._T,{children:[(0,a.jsxs)(o.fY,{children:[(0,a.jsx)(o.f$,{children:null==eU?void 0:eU.title}),(0,a.jsx)(o.yT,{children:null==eU?void 0:eU.description})]}),(0,a.jsxs)(o.xo,{children:[(0,a.jsx)(o.le,{children:"Отмена"}),(0,a.jsx)(o.OL,{onClick:eO,disabled:J,className:"".concat((null==eU?void 0:eU.variant)==="destructive"?"bg-destructive text-destructive-foreground hover:bg-destructive/90":""," flex items-center"),children:J?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"delete"===L?"Удаление...":"Выполнение..."]}):null==eU?void 0:eU.actionText})]})]})}),(0,a.jsx)(d.Vq,{open:M,onOpenChange:R,children:(0,a.jsxs)(d.cZ,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[(0,a.jsxs)(d.fK,{children:[(0,a.jsx)(d.$N,{className:"text-2xl pr-8",children:null==P?void 0:P.title}),(0,a.jsxs)(d.Be,{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex gap-4 text-sm",children:[(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"Автор:"})," ",(null==P?void 0:P.author)||"—"]}),(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"Источник:"})," ",(null==P?void 0:P.feedName)||(null==P?void 0:P.source)||"—"]}),(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"Дата:"})," ",P&&eH(P.createdAt)]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsx)(c.C,{variant:(null==P?void 0:P.processed)?"secondary":"outline",className:(null==P?void 0:P.processed)?"border-green-500/20 bg-green-500/10 text-green-700 dark:text-green-400":"text-muted-foreground",children:(null==P?void 0:P.processed)?"Обработан":"Не обработан"}),(0,a.jsx)(c.C,{variant:(null==P?void 0:P.published)?"secondary":"outline",className:(null==P?void 0:P.published)?"border-blue-500/20 bg-blue-500/10 text-blue-700 dark:text-blue-400":"text-muted-foreground",children:(null==P?void 0:P.published)?"Опубликован":"Не опубликован"})]})]})]}),(null==P?void 0:P.summary)&&(0,a.jsx)("div",{className:"mt-4 text-sm text-foreground leading-relaxed whitespace-pre-wrap",children:P.summary}),(0,a.jsx)("div",{className:"mt-4",children:(null==P?void 0:P.fullContent)?(0,a.jsx)("div",{className:"prose prose-sm max-w-none dark:prose-invert",dangerouslySetInnerHTML:{__html:P.fullContent.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/on\w+="[^"]*"/g,"").replace(/on\w+='[^']*'/g,"")}}):(0,a.jsx)("p",{className:"text-muted-foreground",children:null==P?void 0:P.content})}),(0,a.jsx)("div",{className:"mt-6 space-y-6",children:ec?(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Загрузка справочников..."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(p._,{className:"text-sm font-medium",children:"Категории"}),(0,a.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:ey.categoryIds.length>0?ey.categoryIds.map(e=>{let s=en.categories.find(s=>s.id===e);return s?(0,a.jsxs)(c.C,{variant:"secondary",className:"gap-1",children:[s.name,(0,a.jsx)("button",{type:"button",className:"ml-1 inline-flex h-4 w-4 items-center justify-center rounded-sm hover:text-destructive",onClick:()=>eL("categoryIds",e),children:(0,a.jsx)(k.Z,{className:"h-3 w-3"})})]},"selected-category-".concat(e)):null}):(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"Не выбрано"})}),(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsx)(O,{label:"Выбрать категории",options:en.categories.map(e=>({value:e.id,label:e.name})),selected:ey.categoryIds,onChange:e=>eN(s=>({...s,categoryIds:e})),disabled:0===en.categories.length})}),(0,a.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,a.jsx)(x.I,{value:ej.category,onChange:eV("category"),placeholder:"Новая категория",className:"h-9"}),(0,a.jsx)(l.z,{size:"sm",onClick:()=>eJ("category"),disabled:"category"===eg,children:"category"===eg?"Добавление...":"Добавить"})]})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(p._,{className:"text-sm font-medium",children:"Страны"}),(0,a.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:ey.countryIds.length>0?ey.countryIds.map(e=>{let s=en.countries.find(s=>s.id===e);return s?(0,a.jsxs)(c.C,{variant:"secondary",className:"gap-1",children:[s.name,(0,a.jsx)("button",{type:"button",className:"ml-1 inline-flex h-4 w-4 items-center justify-center rounded-sm hover:text-destructive",onClick:()=>eL("countryIds",e),children:(0,a.jsx)(k.Z,{className:"h-3 w-3"})})]},"selected-country-".concat(e)):null}):(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"Не выбрано"})}),(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsx)(O,{label:"Выбрать страны",options:en.countries.map(e=>({value:e.id,label:e.name})),selected:ey.countryIds,onChange:e=>eN(s=>({...s,countryIds:e})),disabled:0===en.countries.length})}),(0,a.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,a.jsx)(x.I,{value:ej.country,onChange:eV("country"),placeholder:"Новая страна",className:"h-9"}),(0,a.jsx)(l.z,{size:"sm",onClick:()=>eJ("country"),disabled:"country"===eg,children:"country"===eg?"Добавление...":"Добавить"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(p._,{className:"text-sm font-medium",children:"Города"}),(0,a.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:ey.cityIds.length>0?ey.cityIds.map(e=>{let s=eb.find(s=>s.value===e);return s?(0,a.jsxs)(c.C,{variant:"secondary",className:"gap-1",children:[s.label,(0,a.jsx)("button",{type:"button",className:"ml-1 inline-flex h-4 w-4 items-center justify-center rounded-sm hover:text-destructive",onClick:()=>eL("cityIds",e),children:(0,a.jsx)(k.Z,{className:"h-3 w-3"})})]},"selected-city-".concat(e)):null}):(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"Не выбрано"})}),(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsx)(O,{label:"Выбрать города",options:eb,selected:ey.cityIds,onChange:e=>eN(s=>({...s,cityIds:e})),disabled:0===eb.length})}),(0,a.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,a.jsx)(x.I,{value:ej.city,onChange:eV("city"),placeholder:"Новый город",className:"h-9",disabled:0===ey.countryIds.length}),(0,a.jsx)(l.z,{size:"sm",onClick:()=>eJ("city"),disabled:0===ey.countryIds.length||"city"===eg,children:"city"===eg?"Добавление...":"Добавить"})]})]})]})]})}),(0,a.jsxs)("div",{className:"mt-6 flex justify-end gap-2",children:[(0,a.jsx)(l.z,{onClick:eW,disabled:ex||ec,variant:"outline",children:ex?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Регенерация..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 mr-2"}),"Регенерировать таксономию"]})}),(0,a.jsx)(l.z,{onClick:eY,disabled:eu||ec,children:eu?"Сохранение...":"Сохранить"})]}),((null==P?void 0:P.link)||(null==P?void 0:P.source))&&(0,a.jsx)("div",{className:"mt-6 pt-4 border-t",children:(0,a.jsx)(l.z,{variant:"outline",size:"sm",asChild:!0,children:(0,a.jsxs)("a",{href:P.link||P.source||"#",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2",children:[(0,a.jsx)(z.Z,{className:"h-4 w-4"}),"Открыть источник"]})})})]})})]})})]})}},6780:function(e,s,t){"use strict";t.d(s,{OL:function(){return g},_T:function(){return m},aR:function(){return c},f$:function(){return x},fY:function(){return u},le:function(){return f},xo:function(){return h},yT:function(){return p}});var a=t(7437),r=t(2265),l=t(9546),n=t(7440),i=t(495);let c=l.fC;l.xz;let d=l.h_,o=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.aV,{className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r,ref:s})});o.displayName=l.aV.displayName;let m=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsxs)(d,{children:[(0,a.jsx)(o,{}),(0,a.jsx)(l.VY,{ref:s,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...r})]})});m.displayName=l.VY.displayName;let u=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-2 text-center sm:text-left",s),...t})};u.displayName="AlertDialogHeader";let h=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t})};h.displayName="AlertDialogFooter";let x=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.Dx,{ref:s,className:(0,n.cn)("text-lg font-semibold",t),...r})});x.displayName=l.Dx.displayName;let p=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.dk,{ref:s,className:(0,n.cn)("text-sm text-muted-foreground",t),...r})});p.displayName=l.dk.displayName;let g=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.aU,{ref:s,className:(0,n.cn)((0,i.d)(),t),...r})});g.displayName=l.aU.displayName;let f=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.$j,{ref:s,className:(0,n.cn)((0,i.d)({variant:"outline"}),"mt-2 sm:mt-0",t),...r})});f.displayName=l.$j.displayName},4693:function(e,s,t){"use strict";t.d(s,{C:function(){return i}});var a=t(7437);t(2265);var r=t(3027),l=t(7440);let n=(0,r.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:s,variant:t,...r}=e;return(0,a.jsx)("div",{className:(0,l.cn)(n({variant:t}),s),...r})}}},function(e){e.O(0,[876,776,138,356,402,369,696,89,971,23,744],function(){return e(e.s=1377)}),_N_E=e.O()}]);