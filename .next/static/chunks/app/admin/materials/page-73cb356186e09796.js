(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[227],{1377:function(e,s,t){Promise.resolve().then(t.bind(t,1470))},1470:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return L}});var a=t(7437),l=t(2265),n=t(495),i=t(6013),r=t(6975),c=t(4693),d=t(837),o=t(6780),m=t(5273),u=t(6466),x=t(2738),h=t(3102),g=t(3146),p=t(7135),f=t(4602),j=t(1154),v=t(279),N=t(2023),y=t(6746),w=t(5704),b=t(2083),C=t(4166),S=t(2675),k=t(3925),z=t(7785),I=t(1172),A=t(9346),E=t(664),O=t(870),Z=t(2790),T=t(6219),M=t(7776),R=t(6910);let _={search:"",categories:[],countries:[],cities:[],feeds:[]},P={"generate-summary":{label:"Генерация саммари",successMessage:"Генерация завершена успешно"},published:{label:"Публикация",successMessage:"Публикация завершена успешно"},archived:{label:"Архивирование",successMessage:"Архивирование завершено"},delete:{label:"Удаление",successMessage:"Удаление завершено"}};function D(e){let{label:s,options:t,selected:i,onChange:r,disabled:d,fullWidth:o,maxSelected:m}=e,[u,x]=(0,l.useState)(""),g=e=>{if(i.includes(e))r(i.filter(s=>s!==e));else if(m&&m>0){if(1===m)r([e]);else{let s=[...i,e],t=s.length-m;t>0&&s.splice(0,t),r(s)}}else r([...i,e])},p=(0,l.useMemo)(()=>{let e=u.trim().toLowerCase();return e?t.filter(s=>s.label.toLowerCase().includes(e)):t},[t,u]);return(0,a.jsxs)(R.h_,{onOpenChange:e=>!e&&x(""),children:[(0,a.jsx)(R.$F,{asChild:!0,disabled:d,children:(0,a.jsxs)(n.z,{variant:"outline",size:"sm",className:"".concat(o?"w-full":"min-w-[180px]"," justify-between"),children:[(0,a.jsxs)("span",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("span",{children:s}),i.length>0&&(0,a.jsx)(c.C,{variant:"secondary",className:"px-1 text-xs font-medium",children:i.length})]}),(0,a.jsx)(f.Z,{className:"h-3 w-3 text-muted-foreground"})]})}),(0,a.jsxs)(R.AW,{align:"start",className:"".concat(o?"w-80":"w-64"," max-h-64 overflow-y-auto"),children:[(0,a.jsx)(R.Ju,{children:s}),(0,a.jsx)(R.VD,{}),(0,a.jsx)("div",{className:"p-1",children:(0,a.jsx)(h.I,{placeholder:"Поиск...",value:u,onChange:e=>x(e.target.value),className:"h-8"})}),(0,a.jsx)(R.VD,{}),0===p.length?(0,a.jsx)("div",{className:"px-2 py-1.5 text-xs text-muted-foreground",children:"Ничего не найдено"}):p.map(e=>(0,a.jsx)(R.bO,{checked:i.includes(e.value),onCheckedChange:()=>g(e.value),children:e.label},String(e.value)))]})]})}function L(){let[e,s]=(0,l.useState)([]),[t,f]=(0,l.useState)(!0),[R,L]=(0,l.useState)("all"),[F,q]=(0,l.useState)(null),[H,J]=(0,l.useState)(!1),[V,Y]=(0,l.useState)(!1),[$,W]=(0,l.useState)(new Set),[U,B]=(0,l.useState)(null),X=(0,l.useRef)(!1),[K,Q]=(0,l.useState)(null),[G,ee]=(0,l.useState)({total:0,new:0,processed:0,published:0,archived:0}),[es,et]=(0,l.useState)(1),[ea,el]=(0,l.useState)(50),[en,ei]=(0,l.useState)(1),[er,ec]=(0,l.useState)(0),[ed,eo]=(0,l.useState)({categories:[],countries:[]}),[em,eu]=(0,l.useState)(!1),[ex,eh]=(0,l.useState)(_),[eg,ep]=(0,l.useState)(!1),[ef,ej]=(0,l.useState)(!1),[ev,eN]=(0,l.useState)(null),[ey,ew]=(0,l.useState)({category:"",country:"",city:""}),[eb,eC]=(0,l.useState)({categoryIds:[],countryIds:[],cityIds:[]}),[eS,ek]=(0,l.useState)(""),[ez,eI]=(0,l.useState)(""),[eA,eE]=(0,l.useState)(!1),eO=(0,l.useMemo)(()=>{let s=new Set;return e.forEach(e=>{let t=e.feedName||e.source;t&&s.add(t)}),Array.from(s).sort((e,s)=>e.localeCompare(s,"ru"))},[e]),eZ=(0,l.useMemo)(()=>{let e=[];return ed.countries.forEach(s=>{s.cities.forEach(t=>{e.push({value:t.id,label:"".concat(t.name," — ").concat(s.name)})})}),e.sort((e,s)=>e.label.localeCompare(s.label,"ru"))},[ed.countries]),eT=(0,l.useMemo)(()=>{var e,s;return!!F&&(eS!==(null!==(e=F.summary)&&void 0!==e?e:"")||ez!==(null!==(s=F.metaDescription)&&void 0!==s?s:""))},[F,eS,ez]),eM=(0,l.useMemo)(()=>ex.search.trim().length>0||ex.categories.length>0||ex.countries.length>0||ex.cities.length>0||ex.feeds.length>0,[ex]),eR=(0,l.useCallback)(async function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:es,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=null!==(e=l.silent)&&void 0!==e&&e;n||f(!0);try{let e=new URLSearchParams;e.set("status",t),e.set("page",a.toString()),e.set("pageSize",ea.toString()),ex.search&&e.set("search",ex.search),ex.categories.length>0&&e.set("categoryIds",ex.categories.join(",")),ex.countries.length>0&&e.set("countryIds",ex.countries.join(",")),ex.cities.length>0&&e.set("cityIds",ex.cities.join(",")),ex.feeds.length>0&&e.set("feedNames",ex.feeds.join(","));let l=await fetch("/api/materials?".concat(e.toString())),n=await l.json();n.success&&(s(n.data),n.pagination&&(ei(n.pagination.totalPages),ec(n.pagination.total),et(n.pagination.page)),ee(n.stats||{total:0,new:0,processed:0,published:0,archived:0}))}catch(e){console.error("Error fetching materials:",e)}finally{n||f(!1)}},[ex,ea,es]),e_=(0,l.useCallback)(async(e,s)=>{let t=await fetch("/api/materials",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,...s})}),a=await t.json();if(!t.ok||!a.success)throw Error(a.error||"Не удалось обновить материал")},[]);(0,l.useEffect)(()=>{et(1),W(new Set)},[ex,R]),(0,l.useEffect)(()=>{H||Y(!1)},[H]),(0,l.useEffect)(()=>{eR(R,es)},[eR,R,es]),(0,l.useEffect)(()=>{let e=new EventSource("/api/materials/stream?status=".concat(R));return e.onmessage=e=>{try{let l=JSON.parse(e.data);if("new-material"===l.type){let e=l.data,n=!0;if(ex.categories.length>0){var t,a;let s=null!==(a=null===(t=e.categories)||void 0===t?void 0:t.map(e=>e.id))&&void 0!==a?a:[];ex.categories.some(e=>s.includes(e))||(n=!1)}if(n&&ex.countries.length>0){let s=Array.isArray(e.countries)?e.countries.map(e=>e.id):[];ex.countries.some(e=>s.includes(e))||(n=!1)}if(n&&ex.cities.length>0){let s=Array.isArray(e.cities)?e.cities.map(e=>e.id):[];ex.cities.some(e=>s.includes(e))||(n=!1)}if(n&&ex.feeds.length>0){let s=e.feedName||e.source||"";ex.feeds.includes(s)||(n=!1)}if(n&&ex.search.trim()){let s=ex.search.trim().toLowerCase();[e.title,e.summary,e.content,e.feedName,e.source].filter(Boolean).join(" ").toLowerCase().includes(s)||(n=!1)}n&&"all"!==R&&("new"===R&&"new"!==e.status?n=!1:"processed"===R&&"processed"!==e.status?n=!1:"published"===R&&"published"!==e.status?n=!1:"archived"===R&&"archived"!==e.status?n=!1:["processed","published","archived","new"].includes(R)||e.status===R||(n=!1)),n&&(1===es?(s(s=>[e,...s].slice(0,ea)),ec(e=>e+1)):eR(R,es))}else"sync-complete"===l.type&&eR(R,es)}catch(e){console.error("Error parsing SSE message:",e)}},e.onerror=s=>{console.error("SSE connection error:",s),setTimeout(()=>{e.close()},5e3)},()=>{e.close()}},[R,ex,es,ea,eR]);let eP=async()=>{try{eu(!0);let t=await fetch("/api/taxonomy"),a=await t.json();if(a.success){var e,s;eo({categories:null!==(e=a.categories)&&void 0!==e?e:[],countries:null!==(s=a.countries)&&void 0!==s?s:[]})}else M.Am.error(a.error||"Не удалось загрузить таксономию")}catch(e){console.error("Error fetching taxonomy:",e),M.Am.error("Не удалось загрузить таксономию")}finally{eu(!1)}},eD=e=>{if(null==U?void 0:U.running){M.Am.info("Дождитесь завершения текущего процесса");return}if(0===$.size){M.Am.warning("Выберите материалы для обработки");return}Q(e)},eL=(0,l.useCallback)(async()=>{if(!K)return;let s=Array.from($);if(0===s.length){Q(null),M.Am.warning("Нет выбранных материалов для обработки");return}Q(null);let t=P[K];B({action:K,label:t.label,total:s.length,completed:0,success:0,failed:0,running:!0,stopRequested:!1,message:"Запуск...",errors:[]}),X.current=!1;let a=new Map(e.map(e=>[e.id,e])),l=[],n=0,i=0,r=0,c=e=>{B(s=>s?{...s,...e}:s)},d=e=>{c({completed:r,success:n,failed:i,message:e})},o=async(e,s)=>{await e_(e,s)};try{var m,u,x,h,g,p,f,j;if("generate-summary"===K){for(let e of s){if(X.current){c({message:"Остановка запрошена. Завершаем процесс..."});break}let t=a.get(e);d("Генерация саммари: ".concat(null!==(m=null==t?void 0:t.title)&&void 0!==m?m:e));try{let s=await fetch("/api/materials/generate-summary",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({materialId:e})}),t=await s.json();if(!s.ok||!t.success)throw Error(t.error||"Не удалось сгенерировать саммари");n++}catch(s){i++,l.push({id:e,title:null!==(x=null===(u=a.get(e))||void 0===u?void 0:u.title)&&void 0!==x?x:e,message:s instanceof Error?s.message:String(s)})}r++,d("Обработано ".concat(r,"/").concat(s.length))}n>0&&await eP()}else if("delete"===K)for(let e of s){if(X.current){c({message:"Остановка запрошена. Завершаем процесс..."});break}let t=a.get(e);d("Удаление: ".concat(null!==(h=null==t?void 0:t.title)&&void 0!==h?h:e));try{let s=await fetch("/api/materials?id=".concat(e),{method:"DELETE"});if(!s.ok){let e=await s.json().catch(()=>null);throw Error((null==e?void 0:e.error)||"Не удалось удалить материал")}n++}catch(s){i++,l.push({id:e,title:null!==(g=null==t?void 0:t.title)&&void 0!==g?g:e,message:s instanceof Error?s.message:String(s)})}r++,d("Обработано ".concat(r,"/").concat(s.length))}else if("archived"===K)for(let e of s){if(X.current){c({message:"Остановка запрошена. Завершаем процесс..."});break}let t=a.get(e);d("Архивирование: ".concat(null!==(p=null==t?void 0:t.title)&&void 0!==p?p:e));try{await o(e,{status:"archived",published:!1}),n++}catch(s){i++,l.push({id:e,title:null!==(f=null==t?void 0:t.title)&&void 0!==f?f:e,message:s instanceof Error?s.message:String(s)})}r++,d("Обработано ".concat(r,"/").concat(s.length))}else if("published"===K)for(let e of s){if(X.current){c({message:"Остановка запрошена. Завершаем процесс..."});break}let t=a.get(e);if(d("Публикация: ".concat(null!==(j=null==t?void 0:t.title)&&void 0!==j?j:e)),!t){i++,l.push({id:e,title:e,message:"Материал не найден в текущем списке"}),r++,d("Обработано ".concat(r,"/").concat(s.length));continue}if(!t.summary||0===t.summary.trim().length){i++,l.push({id:e,title:t.title,message:"У материала отсутствует саммари, публикация невозможна"}),r++,d("Обработано ".concat(r,"/").concat(s.length));continue}try{await o(e,{published:!0}),n++}catch(s){i++,l.push({id:e,title:t.title,message:s instanceof Error?s.message:String(s)})}r++,d("Обработано ".concat(r,"/").concat(s.length))}}catch(e){l.push({id:"system",title:"Системная ошибка",message:e instanceof Error?e.message:String(e)})}finally{await eR(R,es,{silent:!0}),W(new Set);let e=X.current;X.current=!1;let a=s.length,d=r,o=n,m=i,u="";u=e&&d<a?"Процесс остановлен пользователем. Обработано ".concat(d," из ").concat(a,"."):0===m?"".concat(t.successMessage,". Обработано ").concat(o," из ").concat(a,"."):0===o?"Не удалось выполнить действие. Ошибок: ".concat(m,"."):"Выполнено с ошибками: успешно ".concat(o,", ошибок ").concat(m,"."),c({running:!1,stopRequested:e,completed:d,success:o,failed:m,message:u,errors:l}),e&&d<a?(0,M.Am)(u):0===m?M.Am.success(u):M.Am.warning(u)}},[K,$,e,R,es,eR,eP,e_]),eF=async e=>{L(e),eh(_),await eR(e),W(new Set),et(1)},eq=e=>{var s,t,a,l,n,i,r;q(e),eC({categoryIds:(null===(s=e.categories)||void 0===s?void 0:s.length)?[e.categories[0].id]:[],countryIds:null!==(l=null===(t=e.countries)||void 0===t?void 0:t.map(e=>e.id))&&void 0!==l?l:[],cityIds:null!==(n=null===(a=e.cities)||void 0===a?void 0:a.map(e=>e.id))&&void 0!==n?n:[]}),ek(null!==(i=e.summary)&&void 0!==i?i:""),eI(null!==(r=e.metaDescription)&&void 0!==r?r:""),Y(!1),J(!0)},eH=(es-1)*ea,eJ=eH+e.length,eV=e=>{et(Math.max(1,Math.min(e,en)))},eY=e=>{el(e),et(1)},e$=e=>{if(null==U?void 0:U.running)return;let s=new Set($);s.has(e)?s.delete(e):s.add(e),W(s)},eW=(e,s)=>{eC(t=>{let a=new Set(t[e]);return a.delete(s),{...t,[e]:Array.from(a)}})},eU=e=>{eC(s=>({...s,[e]:[]}))},eB=e=>s=>{ew(t=>({...t,[e]:s.target.value}))},eX=async e=>{let s=ey[e];if(!s.trim()){M.Am.warning("Введите название");return}if("city"===e){if(0===eb.countryIds.length){M.Am.warning("Выберите хотя бы одну страну перед добавлением города");return}let t=eb.countryIds[0];try{eN(e);let a=await fetch("/api/taxonomy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:e,name:s,countryId:t})}),l=await a.json();if(!l.success){M.Am.error(l.error||"Не удалось создать элемент");return}await eP(),eC(e=>({...e,cityIds:Array.from(new Set([...e.cityIds,l.data.id]))})),ew(s=>({...s,[e]:""})),M.Am.success("Элемент создан")}catch(e){console.error("Error creating taxonomy item:",e),M.Am.error("Ошибка при создании элемента")}finally{eN(null)}return}try{eN(e);let t=await fetch("/api/taxonomy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:e,name:s})}),a=await t.json();if(!a.success){M.Am.error(a.error||"Не удалось создать элемент");return}switch(await eP(),e){case"category":eC(e=>({...e,categoryIds:[a.data.id]}));break;case"country":eC(e=>({...e,countryIds:Array.from(new Set([...e.countryIds,a.data.id]))}))}ew(s=>({...s,[e]:""})),M.Am.success("Элемент создан")}catch(e){console.error("Error creating taxonomy item:",e),M.Am.error("Ошибка при создании элемента")}finally{eN(null)}},eK=async()=>{if(F)try{eE(!0),ep(!0);let i=[];eT&&i.push(e_(F.id,{summary:eS,metaDescription:ez})),i.push(fetch("/api/materials/taxonomy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({materialId:F.id,categoryIds:eb.categoryIds.slice(0,1),countryIds:eb.countryIds,cityIds:eb.cityIds})}).then(async e=>{let s=await e.json();if(!e.ok||!s.success)throw Error(s.error||"Не удалось сохранить таксономию");return s.data}));let[,r]=await Promise.all(i);if(r){var e,t,a,l,n;s(e=>e.map(e=>e.id===r.id?r:e)),q({...r,summary:eS,metaDescription:ez}),eC({categoryIds:(null===(e=r.categories)||void 0===e?void 0:e.length)?[r.categories[0].id]:[],countryIds:null!==(l=null===(t=r.countries)||void 0===t?void 0:t.map(e=>e.id))&&void 0!==l?l:[],cityIds:null!==(n=null===(a=r.cities)||void 0===a?void 0:a.map(e=>e.id))&&void 0!==n?n:[]})}else q(e=>e&&e.id===F.id?{...e,summary:eS,metaDescription:ez}:e);await eR(R,es,{silent:!0}),M.Am.success("Материал сохранён")}catch(e){console.error("Error saving material:",e),M.Am.error("Не удалось сохранить материал")}finally{eE(!1),ep(!1)}},eQ=async()=>{if(F)try{var e,t,a,l,n,i,r,c;ej(!0);let d=await fetch("/api/materials/regenerate-taxonomy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({materialId:F.id})}),o=await d.json();if(!d.ok)throw Error(o.error||"Ошибка при регенерации таксономии");if(o.success&&(null===(e=o.data)||void 0===e?void 0:e.material)){let e=o.data.material;q(e),ek(null!==(n=e.summary)&&void 0!==n?n:""),eI(null!==(i=e.metaDescription)&&void 0!==i?i:""),eC({categoryIds:(null===(t=e.categories)||void 0===t?void 0:t.length)?[e.categories[0].id]:[],countryIds:null!==(r=null===(a=e.countries)||void 0===a?void 0:a.map(e=>e.id))&&void 0!==r?r:[],cityIds:null!==(c=null===(l=e.cities)||void 0===l?void 0:l.map(e=>e.id))&&void 0!==c?c:[]}),s(s=>s.map(s=>s.id===e.id?e:s)),M.Am.success("Таксономия успешно обновлена"),await eP()}}catch(e){console.error("Error regenerating taxonomy:",e),M.Am.error(e.message||"Ошибка при регенерации таксономии")}finally{ej(!1)}},eG=e=>{switch(e){case"new":return(0,a.jsx)(c.C,{variant:"default",children:"Новый"});case"processed":return(0,a.jsx)(c.C,{variant:"secondary",className:"bg-green-500/10 text-green-700 dark:text-green-400",children:"Обработан"});case"published":return(0,a.jsx)(c.C,{variant:"secondary",className:"bg-blue-500/10 text-blue-700 dark:text-blue-400",children:"Опубликован"});case"archived":return(0,a.jsx)(c.C,{variant:"outline",children:"Архив"});default:return(0,a.jsx)(c.C,{children:e})}},e0=e=>{let s=new Date(e),t=String(s.getDate()).padStart(2,"0"),a=String(s.getMonth()+1).padStart(2,"0"),l=String(s.getFullYear()).slice(-2),n=String(s.getHours()).padStart(2,"0"),i=String(s.getMinutes()).padStart(2,"0");return"".concat(t,".").concat(a,".").concat(l," ").concat(n,":").concat(i)},e1=(()=>{let e=$.size;switch(K){case"published":return{title:"Опубликовать материалы",description:"Вы уверены, что хотите опубликовать ".concat(e," материал(ов)?"),actionText:"Опубликовать",variant:"default"};case"archived":return{title:"Архивировать материалы",description:"Вы уверены, что хотите архивировать ".concat(e," материал(ов)?"),actionText:"Архивировать",variant:"default"};case"delete":return{title:"Удалить материалы",description:"Вы уверены, что хотите удалить ".concat(e," материал(ов)? Это действие необратимо!"),actionText:"Удалить",variant:"destructive"};case"generate-summary":return{title:"Генерация саммари",description:1===e?"Сгенерировать саммари для этого материала?":"Сгенерировать саммари для ".concat(e," материалов?"),actionText:"Сгенерировать",variant:"default"};default:return null}})();return(0,l.useEffect)(()=>{(async()=>{await eR("all"),await eP()})()},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(T.P,{}),(0,a.jsx)("div",{className:"min-h-screen bg-background p-8",children:(0,a.jsxs)("div",{className:"container space-y-6",children:[(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsx)(m.mQ,{value:R,onValueChange:eF,children:(0,a.jsxs)(m.dr,{children:[(0,a.jsxs)(m.SP,{value:"all",children:["Все ",G.total>0&&(0,a.jsxs)("span",{className:"ml-1.5 text-xs",children:["(",G.total,")"]})]}),(0,a.jsxs)(m.SP,{value:"new",children:["Новые ",G.new>0&&(0,a.jsxs)("span",{className:"ml-1.5 text-xs",children:["(",G.new,")"]})]}),(0,a.jsxs)(m.SP,{value:"processed",children:["Обработанные ",G.processed>0&&(0,a.jsxs)("span",{className:"ml-1.5 text-xs",children:["(",G.processed,")"]})]}),(0,a.jsxs)(m.SP,{value:"published",children:["Опубликованные ",G.published>0&&(0,a.jsxs)("span",{className:"ml-1.5 text-xs",children:["(",G.published,")"]})]}),(0,a.jsxs)(m.SP,{value:"archived",children:["Архив ",G.archived>0&&(0,a.jsxs)("span",{className:"ml-1.5 text-xs",children:["(",G.archived,")"]})]})]})})}),U?(0,a.jsx)("div",{className:"fixed bottom-8 left-1/2 -translate-x-1/2 z-50 animate-in slide-in-from-bottom-4 fade-in duration-300 w-[min(90vw,600px)]",children:(0,a.jsx)(i.Zb,{className:"border-primary shadow-2xl",children:(0,a.jsxs)(i.aY,{className:"py-4 px-6 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-semibold",children:U.label}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:U.message}),(0,a.jsxs)("p",{className:"mt-2 text-xs text-muted-foreground",children:["Выполнено ",U.completed," из ",U.total,". Успешно ",U.success,", ошибок ",U.failed,"."]})]}),(0,a.jsx)("div",{className:"flex items-center justify-center rounded-full border bg-background p-2",children:U.running?(0,a.jsx)(j.Z,{className:"h-4 w-4 animate-spin text-primary"}):U.failed>0?(0,a.jsx)(v.Z,{className:"h-4 w-4 text-amber-500"}):(0,a.jsx)(N.Z,{className:"h-4 w-4 text-green-500"})})]}),(0,a.jsx)("div",{className:"h-2 w-full rounded-full bg-muted",children:(0,a.jsx)("div",{className:"h-2 rounded-full bg-primary transition-all",style:{width:"".concat(U.total>0?Math.min(100,Math.round(U.completed/U.total*100)):0,"%")}})}),U.errors.length>0&&(0,a.jsxs)("div",{className:"max-h-32 overflow-y-auto rounded-md border border-border/50 bg-muted/30 p-3 text-xs",children:[(0,a.jsx)("p",{className:"mb-2 font-semibold text-foreground",children:"Ошибки:"}),(0,a.jsx)("div",{className:"space-y-2",children:U.errors.map(e=>(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"font-medium text-foreground break-words",children:e.title}),(0,a.jsx)("p",{className:"text-muted-foreground break-words",children:e.message})]},"".concat(e.id,"-").concat(e.message)))})]}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,a.jsx)(n.z,{variant:"outline",size:"sm",onClick:()=>{U&&U.running&&!U.stopRequested&&(X.current=!0,B(e=>e?{...e,stopRequested:!0,message:"Остановка запрошена. Завершаем текущий элемент..."}:e))},disabled:!U.running||U.stopRequested,className:"flex items-center gap-2",children:U.stopRequested?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y.Z,{className:"h-4 w-4"}),"Остановка..."]}):U.running?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w.Z,{className:"h-4 w-4"}),"Остановить"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w.Z,{className:"h-4 w-4"}),"Остановлено"]})}),(0,a.jsx)(n.z,{size:"sm",onClick:()=>{U&&(!U.running||U.stopRequested)&&(B(null),W(new Set))},disabled:U.running,children:"Закрыть"})]})]})})}):$.size>0&&(0,a.jsx)("div",{className:"fixed bottom-8 left-1/2 -translate-x-1/2 z-50 animate-in slide-in-from-bottom-4 fade-in duration-300",children:(0,a.jsx)(i.Zb,{className:"border-primary shadow-2xl",children:(0,a.jsx)(i.aY,{className:"py-4 px-6",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("span",{className:"text-sm font-medium",children:["Выбрано: ",(0,a.jsx)("span",{className:"text-primary font-bold",children:$.size})," материал(ов)"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(n.z,{size:"sm",variant:"default",onClick:()=>eD("published"),children:[(0,a.jsx)(b.Z,{className:"mr-2 h-4 w-4"}),"Опубликовать"]}),(0,a.jsxs)(n.z,{size:"sm",variant:"secondary",onClick:()=>eD("generate-summary"),children:[(0,a.jsx)(C.Z,{className:"mr-2 h-4 w-4"}),"Саммари"]}),(0,a.jsxs)(n.z,{size:"sm",variant:"outline",onClick:()=>eD("archived"),children:[(0,a.jsx)(S.Z,{className:"mr-2 h-4 w-4"}),"Архивировать"]}),(0,a.jsxs)(n.z,{size:"sm",variant:"destructive",onClick:()=>eD("delete"),children:[(0,a.jsx)(k.Z,{className:"mr-2 h-4 w-4"}),"Удалить"]})]}),(0,a.jsx)(n.z,{size:"sm",variant:"ghost",onClick:()=>W(new Set),children:"Отменить"})]})})})}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)(i.ll,{children:["Материалы (",er,")"]})}),(0,a.jsxs)(i.aY,{children:[(0,a.jsxs)("div",{className:"mb-4 flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsx)(h.I,{placeholder:"Поиск…",value:ex.search,onChange:e=>eh(s=>({...s,search:e.target.value})),className:"h-9 w-full sm:w-64"}),(0,a.jsx)(D,{label:"Категории",options:ed.categories.map(e=>({value:e.id,label:e.isHidden?"".concat(e.name," (скрыта)"):e.name})),selected:ex.categories,onChange:e=>eh(s=>({...s,categories:e})),disabled:0===ed.categories.length}),(0,a.jsx)(D,{label:"Страны",options:ed.countries.map(e=>({value:e.id,label:e.name})),selected:ex.countries,onChange:e=>eh(s=>({...s,countries:e})),disabled:0===ed.countries.length}),(0,a.jsx)(D,{label:"Города",options:eZ,selected:ex.cities,onChange:e=>eh(s=>({...s,cities:e})),disabled:0===eZ.length}),(0,a.jsx)(D,{label:"Источники",options:eO.map(e=>({value:e,label:e})),selected:ex.feeds,onChange:e=>eh(s=>({...s,feeds:e})),disabled:0===eO.length})]}),(0,a.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:(0,a.jsx)(n.z,{variant:"ghost",size:"sm",onClick:()=>eh(_),disabled:!eM,children:"Сбросить фильтры"})})]}),!t&&e.length>0&&(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4 pb-4 border-b",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Показано ",0===e.length?0:eH+1,"-",eJ," из ",er]})}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"На странице:"}),(0,a.jsx)("div",{className:"flex gap-1",children:[25,50,100,200].map(e=>(0,a.jsx)(n.z,{variant:ea===e?"default":"outline",size:"sm",onClick:()=>eY(e),className:"h-8 w-12",children:e},e))})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(n.z,{variant:"outline",size:"sm",onClick:()=>eV(1),disabled:1===es,className:"h-8 w-8 p-0",title:"Первая страница",children:(0,a.jsx)(z.Z,{className:"h-4 w-4"})}),(0,a.jsx)(n.z,{variant:"outline",size:"sm",onClick:()=>eV(es-1),disabled:1===es,className:"h-8 w-8 p-0",title:"Предыдущая страница",children:(0,a.jsx)(I.Z,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{className:"flex items-center gap-1 px-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:es}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"из"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:en})]}),(0,a.jsx)(n.z,{variant:"outline",size:"sm",onClick:()=>eV(es+1),disabled:es===en,className:"h-8 w-8 p-0",title:"Следующая страница",children:(0,a.jsx)(A.Z,{className:"h-4 w-4"})}),(0,a.jsx)(n.z,{variant:"outline",size:"sm",onClick:()=>eV(en),disabled:es===en,className:"h-8 w-8 p-0",title:"Последняя страница",children:(0,a.jsx)(E.Z,{className:"h-4 w-4"})})]})]})]}),t?(0,a.jsx)("div",{className:"space-y-2",children:Array.from({length:10}).map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(x.O,{className:"h-12 w-12"}),(0,a.jsx)(x.O,{className:"h-16 w-16 rounded"}),(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsx)(x.O,{className:"h-4 w-full"}),(0,a.jsx)(x.O,{className:"h-4 w-3/4"})]}),(0,a.jsx)(x.O,{className:"h-8 w-24"}),(0,a.jsx)(x.O,{className:"h-8 w-20"})]},s))}):0===e.length?(0,a.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:eM?"Материалы по выбранным фильтрам не найдены.":"Нет материалов. Добавьте RSS фиды и синхронизируйте их на главной."}):(0,a.jsxs)(r.iA,{children:[(0,a.jsx)(r.xD,{children:(0,a.jsxs)(r.SC,{children:[(0,a.jsx)(r.ss,{className:"w-12",children:(0,a.jsx)(u.X,{checked:e.length>0&&e.every(e=>$.has(e.id)),onCheckedChange:()=>{if(null==U||!U.running){if($.size===e.length&&e.length>0){let s=new Set($);e.forEach(e=>s.delete(e.id)),W(s)}else{let s=new Set($);e.forEach(e=>s.add(e.id)),W(s)}}},disabled:!!(null==U?void 0:U.running)})}),(0,a.jsx)(r.ss,{className:"w-20",children:"Обложка"}),(0,a.jsx)(r.ss,{className:"min-w-[300px]",children:"Заголовок"}),(0,a.jsx)(r.ss,{className:"w-[220px]",children:"Категории"}),(0,a.jsx)(r.ss,{children:"Источник"}),(0,a.jsx)(r.ss,{className:"w-[130px]",children:"Дата"}),(0,a.jsx)(r.ss,{className:"w-[140px]",children:"Статус"})]})}),(0,a.jsx)(r.RM,{children:(null==U?void 0:U.running)?Array.from({length:Math.min(e.length||ea,ea)}).map((e,s)=>(0,a.jsxs)(r.SC,{children:[(0,a.jsx)(r.pj,{children:(0,a.jsx)(x.O,{className:"h-4 w-4 rounded"})}),(0,a.jsx)(r.pj,{children:(0,a.jsx)(x.O,{className:"h-16 w-16 rounded"})}),(0,a.jsxs)(r.pj,{children:[(0,a.jsx)(x.O,{className:"h-4 w-48"}),(0,a.jsx)(x.O,{className:"mt-2 h-4 w-64"})]}),(0,a.jsx)(r.pj,{children:(0,a.jsx)(x.O,{className:"h-4 w-40"})}),(0,a.jsx)(r.pj,{children:(0,a.jsx)(x.O,{className:"h-4 w-28"})}),(0,a.jsx)(r.pj,{children:(0,a.jsx)(x.O,{className:"h-4 w-24"})}),(0,a.jsx)(r.pj,{children:(0,a.jsx)(x.O,{className:"h-4 w-24"})})]},"bulk-skeleton-".concat(s))):e.map(e=>(0,a.jsxs)(r.SC,{className:"cursor-pointer hover:bg-accent/50",children:[(0,a.jsx)(r.pj,{onClick:e=>e.stopPropagation(),children:(0,a.jsx)(u.X,{checked:$.has(e.id),onCheckedChange:()=>e$(e.id),disabled:!!(null==U?void 0:U.running)})}),(0,a.jsx)(r.pj,{onClick:()=>!(null==U?void 0:U.running)&&eq(e),children:e.thumbnail?(0,a.jsx)("img",{src:e.thumbnail,alt:e.title,className:"w-16 h-16 object-cover rounded",onError:e=>{e.currentTarget.style.display="none"}}):(0,a.jsx)("div",{className:"w-16 h-16 bg-muted rounded flex items-center justify-center text-xs text-muted-foreground",children:"Нет фото"})}),(0,a.jsx)(r.pj,{className:"font-medium",onClick:()=>!(null==U?void 0:U.running)&&eq(e),children:(0,a.jsx)("div",{className:"line-clamp-3 leading-snug",children:e.title})}),(0,a.jsx)(r.pj,{onClick:()=>!(null==U?void 0:U.running)&&eq(e),children:e.categories&&e.categories.length>0?(0,a.jsxs)("div",{className:"flex max-w-[220px] flex-wrap gap-1",children:[e.categories.slice(0,3).map(s=>(0,a.jsx)(c.C,{variant:"outline",className:"text-xs font-normal",children:s.name},"".concat(e.id,"-category-").concat(s.id))),e.categories.length>3&&(0,a.jsxs)(c.C,{variant:"secondary",className:"text-xs font-normal",children:["+",e.categories.length-3]})]}):(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"—"})}),(0,a.jsx)(r.pj,{onClick:()=>!(null==U?void 0:U.running)&&eq(e),children:(0,a.jsx)("div",{className:"truncate max-w-[200px]",title:e.feedName||e.source,children:e.feedName||e.source||"—"})}),(0,a.jsx)(r.pj,{onClick:()=>!(null==U?void 0:U.running)&&eq(e),children:e0(e.createdAt)}),(0,a.jsx)(r.pj,{onClick:()=>!(null==U?void 0:U.running)&&eq(e),children:eG(e.status)})]},e.id))})]}),!t&&e.length>0&&(0,a.jsxs)("div",{className:"flex items-center justify-between mt-4 pt-4 border-t",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Показано ",0===e.length?0:eH+1,"-",eJ," из ",er]})}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"На странице:"}),(0,a.jsx)("div",{className:"flex gap-1",children:[25,50,100,200].map(e=>(0,a.jsx)(n.z,{variant:ea===e?"default":"outline",size:"sm",onClick:()=>eY(e),className:"h-8 w-12",children:e},e))})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(n.z,{variant:"outline",size:"sm",onClick:()=>eV(1),disabled:1===es,className:"h-8 w-8 p-0",title:"Первая страница",children:(0,a.jsx)(z.Z,{className:"h-4 w-4"})}),(0,a.jsx)(n.z,{variant:"outline",size:"sm",onClick:()=>eV(es-1),disabled:1===es,className:"h-8 w-8 p-0",title:"Предыдущая страница",children:(0,a.jsx)(I.Z,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{className:"flex items-center gap-1 px-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:es}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"из"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:en})]}),(0,a.jsx)(n.z,{variant:"outline",size:"sm",onClick:()=>eV(es+1),disabled:es===en,className:"h-8 w-8 p-0",title:"Следующая страница",children:(0,a.jsx)(A.Z,{className:"h-4 w-4"})}),(0,a.jsx)(n.z,{variant:"outline",size:"sm",onClick:()=>eV(en),disabled:es===en,className:"h-8 w-8 p-0",title:"Последняя страница",children:(0,a.jsx)(E.Z,{className:"h-4 w-4"})})]})]})]})]})]}),(0,a.jsx)(o.aR,{open:null!==K,onOpenChange:e=>!e&&Q(null),children:(0,a.jsxs)(o._T,{children:[(0,a.jsxs)(o.fY,{children:[(0,a.jsx)(o.f$,{children:null==e1?void 0:e1.title}),(0,a.jsx)(o.yT,{children:null==e1?void 0:e1.description})]}),(0,a.jsxs)(o.xo,{children:[(0,a.jsx)(o.le,{children:"Отмена"}),(0,a.jsx)(o.OL,{onClick:eL,disabled:(null==U?void 0:U.running)===!0,className:"".concat((null==e1?void 0:e1.variant)==="destructive"?"bg-destructive text-destructive-foreground hover:bg-destructive/90":""),children:null==e1?void 0:e1.actionText})]})]})}),(0,a.jsx)(d.Vq,{open:H,onOpenChange:J,children:(0,a.jsxs)(d.cZ,{className:"w-[min(95vw,1100px)] max-h-[85vh] overflow-y-auto",children:[(0,a.jsxs)(d.fK,{children:[(0,a.jsx)(d.$N,{className:"text-2xl pr-8",children:null==F?void 0:F.title}),(0,a.jsxs)(d.Be,{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm",children:[(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"Автор:"})," ",(null==F?void 0:F.author)||"—"]}),(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"Источник:"})," ",(null==F?void 0:F.feedName)||(null==F?void 0:F.source)||"—"]}),(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"Дата:"})," ",F&&e0(F.createdAt)]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsx)(c.C,{variant:(null==F?void 0:F.processed)?"secondary":"outline",className:(null==F?void 0:F.processed)?"border-green-500/20 bg-green-500/10 text-green-700 dark:text-green-400":"text-muted-foreground",children:(null==F?void 0:F.processed)?"Обработан":"Не обработан"}),(0,a.jsx)(c.C,{variant:(null==F?void 0:F.published)?"secondary":"outline",className:(null==F?void 0:F.published)?"border-blue-500/20 bg-blue-500/10 text-blue-700 dark:text-blue-400":"text-muted-foreground",children:(null==F?void 0:F.published)?"Опубликован":"Не опубликован"})]})]})]}),(0,a.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Мета описание"}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:[ez.length,"/160"]})]}),(0,a.jsx)(g.g,{value:ez,onChange:e=>eI(e.target.value),maxLength:160,rows:3,placeholder:"Краткое описание статьи"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Саммари"}),(null==F?void 0:F.summary)&&(0,a.jsx)(c.C,{variant:"secondary",children:"AI"})]}),(0,a.jsx)(g.g,{value:eS,onChange:e=>ek(e.target.value),rows:6,placeholder:"Краткое саммари на 3-5 предложений"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Категории публикации"})}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:eb.categoryIds.length>0?eb.categoryIds.map(e=>ed.categories.find(s=>s.id===e)).filter(e=>!!e).map(e=>(0,a.jsxs)(c.C,{variant:e.isHidden?"outline":"secondary",className:"gap-1",children:[e.name,e.isHidden&&(0,a.jsx)("span",{className:"ml-1 rounded bg-muted px-1 text-[10px] uppercase text-muted-foreground",children:"скрыта"}),(0,a.jsx)(n.z,{type:"button",variant:"ghost",size:"icon",className:"h-4 w-4 text-muted-foreground hover:text-destructive",onClick:()=>eW("categoryIds",e.id),children:(0,a.jsx)(O.Z,{className:"h-3 w-3"})})]},"pub-category-".concat(e.id))):(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"У материала нет выбранных категорий"})})]})]}),(0,a.jsxs)("div",{className:"mt-6 space-y-3",children:[(0,a.jsx)(n.z,{variant:"outline",size:"sm",onClick:()=>Y(e=>!e),className:"w-full sm:w-56",children:V?"Скрыть полный текст":"Показать полный текст"}),V&&(0,a.jsx)("div",{className:"rounded-lg border bg-background p-4 text-sm leading-relaxed",children:(null==F?void 0:F.fullContent)?(0,a.jsx)("div",{className:"prose prose-sm max-w-none dark:prose-invert",dangerouslySetInnerHTML:{__html:F.fullContent.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/on\w+="[^"]*"/g,"").replace(/on\w+='[^']*'/g,"")}}):(0,a.jsx)("p",{className:"text-foreground",children:null==F?void 0:F.content})})]}),(0,a.jsx)("div",{className:"mt-6 space-y-6",children:em?(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Загрузка справочников..."}):(0,a.jsxs)("div",{className:"space-y-5",children:[(0,a.jsxs)("section",{className:"rounded-lg border bg-muted/30 p-4 space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(p._,{className:"text-sm font-semibold",children:"Категории"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Выберите 1–3 наиболее релевантных категории или добавьте новую."})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3",children:[(0,a.jsx)(D,{label:"Добавить из списка",options:ed.categories.map(e=>({value:e.id,label:e.isHidden?"".concat(e.name," (скрыта)"):e.name})),selected:eb.categoryIds,onChange:e=>eC(s=>({...s,categoryIds:e})),disabled:0===ed.categories.length,fullWidth:!0,maxSelected:1}),(0,a.jsx)(n.z,{variant:"ghost",size:"sm",onClick:()=>eU("categoryIds"),disabled:0===eb.categoryIds.length,className:"sm:w-auto w-full",children:"Очистить"})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:eb.categoryIds.length>0?eb.categoryIds.map(e=>{let s=ed.categories.find(s=>s.id===e);return s?(0,a.jsxs)(c.C,{variant:"secondary",className:"gap-1",children:[s.name,(0,a.jsx)("button",{type:"button",className:"ml-1 inline-flex h-4 w-4 items-center justify-center rounded-sm hover:text-destructive",onClick:()=>eW("categoryIds",e),children:(0,a.jsx)(O.Z,{className:"h-3 w-3"})})]},"selected-category-".concat(e)):null}):(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"Категории не выбраны"})}),(0,a.jsxs)("div",{className:"space-y-2 border-t pt-4",children:[(0,a.jsx)(p._,{className:"text-xs font-medium text-muted-foreground",children:"Нет нужной категории?"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row",children:[(0,a.jsx)(h.I,{value:ey.category,onChange:eB("category"),placeholder:"Название новой категории",className:"h-9"}),(0,a.jsx)(n.z,{size:"sm",onClick:()=>eX("category"),disabled:"category"===ev,children:"category"===ev?"Добавление...":"Добавить"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-5",children:[(0,a.jsxs)("section",{className:"rounded-lg border bg-muted/10 p-4 space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(p._,{className:"text-sm font-semibold",children:"Страны"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Укажите страны, к которым относится материал."})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3",children:[(0,a.jsx)(D,{label:"Добавить страну",options:ed.countries.map(e=>({value:e.id,label:e.name})),selected:eb.countryIds,onChange:e=>eC(s=>({...s,countryIds:e})),disabled:0===ed.countries.length,fullWidth:!0}),(0,a.jsx)(n.z,{variant:"ghost",size:"sm",onClick:()=>eU("countryIds"),disabled:0===eb.countryIds.length,className:"sm:w-auto w-full",children:"Очистить"})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:eb.countryIds.length>0?eb.countryIds.map(e=>{let s=ed.countries.find(s=>s.id===e);return s?(0,a.jsxs)(c.C,{variant:"secondary",className:"gap-1",children:[s.name,(0,a.jsx)("button",{type:"button",className:"ml-1 inline-flex h-4 w-4 items-center justify-center rounded-sm hover:text-destructive",onClick:()=>eW("countryIds",e),children:(0,a.jsx)(O.Z,{className:"h-3 w-3"})})]},"selected-country-".concat(e)):null}):(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"Страны не выбраны"})}),(0,a.jsxs)("div",{className:"space-y-2 border-t pt-4",children:[(0,a.jsx)(p._,{className:"text-xs font-medium text-muted-foreground",children:"Добавить новую страну"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row",children:[(0,a.jsx)(h.I,{value:ey.country,onChange:eB("country"),placeholder:"Название новой страны",className:"h-9"}),(0,a.jsx)(n.z,{size:"sm",onClick:()=>eX("country"),disabled:"country"===ev,children:"country"===ev?"Добавление...":"Добавить"})]})]})]}),(0,a.jsxs)("section",{className:"rounded-lg border bg-muted/10 p-4 space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(p._,{className:"text-sm font-semibold",children:"Города"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Выберите города. Сначала укажите страну — мы подберём связанные города автоматически."})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3",children:[(0,a.jsx)(D,{label:"Добавить город",options:eZ,selected:eb.cityIds,onChange:e=>eC(s=>({...s,cityIds:e})),disabled:0===eZ.length,fullWidth:!0}),(0,a.jsx)(n.z,{variant:"ghost",size:"sm",onClick:()=>eU("cityIds"),disabled:0===eb.cityIds.length,className:"sm:w-auto w-full",children:"Очистить"})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:eb.cityIds.length>0?eb.cityIds.map(e=>{let s=eZ.find(s=>s.value===e);return s?(0,a.jsxs)(c.C,{variant:"secondary",className:"gap-1",children:[s.label,(0,a.jsx)("button",{type:"button",className:"ml-1 inline-flex h-4 w-4 items-center justify-center rounded-sm hover:text-destructive",onClick:()=>eW("cityIds",e),children:(0,a.jsx)(O.Z,{className:"h-3 w-3"})})]},"selected-city-".concat(e)):null}):(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"Города не выбраны"})}),(0,a.jsxs)("div",{className:"space-y-2 border-t pt-4",children:[(0,a.jsx)(p._,{className:"text-xs font-medium text-muted-foreground",children:"Добавить новый город"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row",children:[(0,a.jsx)(h.I,{value:ey.city,onChange:eB("city"),placeholder:"Название нового города",className:"h-9",disabled:0===eb.countryIds.length}),(0,a.jsx)(n.z,{size:"sm",onClick:()=>eX("city"),disabled:0===eb.countryIds.length||"city"===ev,children:"city"===ev?"Добавление...":"Добавить"})]}),0===eb.countryIds.length&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Чтобы добавить город, сначала выберите страну."})]})]})]})]})}),(0,a.jsxs)("div",{className:"mt-6 flex flex-col items-end gap-2",children:[(0,a.jsx)(n.z,{onClick:eQ,disabled:ef||em,variant:"outline",className:"w-full sm:w-56",children:ef?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Регенерация..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C.Z,{className:"mr-2 h-4 w-4"}),"Регенерировать таксономию"]})}),(0,a.jsx)(n.z,{onClick:eK,disabled:eA||eg||em,className:"w-full sm:w-56",children:eA||eg?"Сохранение...":"Сохранить"})]}),((null==F?void 0:F.link)||(null==F?void 0:F.source))&&(0,a.jsx)("div",{className:"mt-6 pt-4 border-t",children:(0,a.jsx)(n.z,{variant:"outline",size:"sm",asChild:!0,children:(0,a.jsxs)("a",{href:F.link||F.source||"#",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2",children:[(0,a.jsx)(Z.Z,{className:"h-4 w-4"}),"Открыть источник"]})})})]})})]})})]})}},6780:function(e,s,t){"use strict";t.d(s,{OL:function(){return p},_T:function(){return m},aR:function(){return c},f$:function(){return h},fY:function(){return u},le:function(){return f},xo:function(){return x},yT:function(){return g}});var a=t(7437),l=t(2265),n=t(9546),i=t(7440),r=t(495);let c=n.fC;n.xz;let d=n.h_,o=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(n.aV,{className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...l,ref:s})});o.displayName=n.aV.displayName;let m=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsxs)(d,{children:[(0,a.jsx)(o,{}),(0,a.jsx)(n.VY,{ref:s,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...l})]})});m.displayName=n.VY.displayName;let u=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-2 text-center sm:text-left",s),...t})};u.displayName="AlertDialogHeader";let x=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t})};x.displayName="AlertDialogFooter";let h=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(n.Dx,{ref:s,className:(0,i.cn)("text-lg font-semibold",t),...l})});h.displayName=n.Dx.displayName;let g=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(n.dk,{ref:s,className:(0,i.cn)("text-sm text-muted-foreground",t),...l})});g.displayName=n.dk.displayName;let p=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(n.aU,{ref:s,className:(0,i.cn)((0,r.d)(),t),...l})});p.displayName=n.aU.displayName;let f=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(n.$j,{ref:s,className:(0,i.cn)((0,r.d)({variant:"outline"}),"mt-2 sm:mt-0",t),...l})});f.displayName=n.$j.displayName}},function(e){e.O(0,[876,776,138,356,402,395,320,369,971,23,744],function(){return e(e.s=1377)}),_N_E=e.O()}]);